

<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noodp" />
    <title>了解Java Stream流操作 - HongSpell</title><meta name="Description" content=""><meta property="og:title" content="了解Java Stream流操作" />
<meta property="og:description" content="Static Class 静态类可以在一个类里面定义静态类，比如，内部类 (nested class)。把nested class封闭起来的叫外部类。只有内部类才可以static。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://hongspell.site/java-stream%E6%93%8D%E4%BD%9C/" /><meta property="og:image" content="https://hongspell.site/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-09-21T16:19:14+08:00" />
<meta property="article:modified_time" content="2023-09-21T16:19:14+08:00" /><meta property="og:site_name" content="HongSpell" />



<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://hongspell.site/" /><meta name="twitter:title" content="了解Java Stream流操作"/>
<meta name="twitter:description" content="Static Class 静态类可以在一个类里面定义静态类，比如，内部类 (nested class)。把nested class封闭起来的叫外部类。只有内部类才可以static。"/>
<meta name="twitter:site" content="@ssdlaohu9527"/>
<meta name="application-name" content="HongSpell">
<meta name="apple-mobile-web-app-title" content="HongSpell">

<meta name="theme-color" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><meta name="twitter:creator" content="@ssdlaohu9527" /><link rel="icon" href="/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="canonical" href="https://hongspell.site/java-stream%E6%93%8D%E4%BD%9C/" /><link rel="prev" href="https://hongspell.site/singleton-pattern/" /><link rel="next" href="https://hongspell.site/innodb-page/" />
<link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/color.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/fontawesome-free/all.min.css">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/animate/animate.min.css">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "了解Java Stream流操作",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https://hongspell.site/java-stream%E6%93%8D%E4%BD%9C/"
        },"genre": "posts","keywords": "java, stream, lambda表达式","wordcount":  13865 ,
        "url": "https://hongspell.site/java-stream%E6%93%8D%E4%BD%9C/","datePublished": "2023-09-21T16:19:14+08:00","dateModified": "2023-09-21T16:19:14+08:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "Hong"
            },"description": ""
    }
    </script></head>

<body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">
        function setTheme(theme) {document.body.setAttribute('theme', theme); document.documentElement.style.setProperty('color-scheme', theme === 'light' ? 'light' : 'dark'); window.theme = theme;   window.isDark = window.theme !== 'light' }
        function saveTheme(theme) {window.localStorage && localStorage.setItem('theme', theme);}
        function getMeta(metaName) {const metas = document.getElementsByTagName('meta'); for (let i = 0; i < metas.length; i++) if (metas[i].getAttribute('name') === metaName) return metas[i]; return '';}
        if (window.localStorage && localStorage.getItem('theme')) {let theme = localStorage.getItem('theme');theme === 'light' || theme === 'dark' || theme === 'black' ? setTheme(theme) : (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light')); } else { if ('auto' === 'light' || 'auto' === 'dark' || 'auto' === 'black') setTheme('auto'), saveTheme('auto'); else saveTheme('auto'), window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light');}
        let metaColors = {'light': '#f8f8f8','dark': '#252627','black': '#000000'}
        getMeta('theme-color').content = metaColors[document.body.getAttribute('theme')];
        window.switchThemeEventSet = new Set()
    </script>
    <div id="back-to-top"></div>
    <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="HongSpell"><span id="desktop-header-typeit" class="typeit"></span></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> 文章 </a><a class="menu-item" href="/projects/"> 项目 </a><a class="menu-item" href="/sketch/"> 手绘 </a><a class="menu-item" href="/about/"> 关于 </a><a class="menu-item" href="https://github.com/Hongmiao0207" title="GitHub" rel="noopener noreferrer" target="_blank"><i class='fab fa-github fa-fw'></i>  </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-select" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw"></i>
                    <select class="color-theme-select" id="theme-select-desktop" title="Switch Theme">
                        <option value="light">Light</option>
                        <option value="dark">Dark</option>
                        <option value="black">Black</option>
                        <option value="auto">Auto</option>
                    </select>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="HongSpell"><span id="mobile-header-typeit" class="typeit"></span></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/posts/" title="">文章</a><a class="menu-item" href="/projects/" title="">项目</a><a class="menu-item" href="/sketch/" title="">手绘</a><a class="menu-item" href="/about/" title="">关于</a><a class="menu-item" href="https://github.com/Hongmiao0207" title="GitHub" rel="noopener noreferrer" target="_blank"><i class='fab fa-github fa-fw'></i></a><a href="javascript:void(0);" class="menu-item theme-select" title="Switch Theme">
                <i class="fas fa-adjust fa-fw"></i>
                <select class="color-theme-select" id="theme-select-mobile" title="Switch Theme">
                    <option value="light">Light</option>
                    <option value="dark">Dark</option>
                    <option value="black">Black</option>
                    <option value="auto">Auto</option>
                </select>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
            <div class="container"><script>document.getElementsByTagName("main")[0].setAttribute("autoTOC", "false")</script><article class="page single"><h1 class="single-title animate__animated animate__flipInX">了解Java Stream流操作</h1><div class="post-meta">
            <div class="post-meta-line">
                <span class="post-author"><span class="author fas fa-user-circle fa-fw"></span><a href="/" title="Author" rel=" author" class="author">Hong</a>
                </span>&nbsp;<span class="post-category">included in </span>&nbsp;<span class="post-category">category <a href="/categories/java/"><i class="far fa-folder fa-fw"></i>java</a></span>&nbsp;<span class="post-category">and</span>&nbsp;<span class="post-series">series <a href="/series/java-stream/"><i class="far fa-list-alt fa-fw"></i>java-stream</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2023-09-21">2023-09-21</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;13865 words&nbsp;<i class="far fa-clock fa-fw"></i>&nbsp;28 minutes&nbsp;</div>
        </div><div class="featured-image"><img
        
        loading="eager"
        src="/posts/java/java-stream/java_stream_cover.jpg"
        srcset="/posts/java/java-stream/java_stream_cover.jpg, /posts/java/java-stream/java_stream_cover.jpg 1.5x, /posts/java/java-stream/java_stream_cover.jpg 2x"
        sizes="auto"
        alt="/posts/java/java-stream/java_stream_cover.jpg"
        title="/posts/java/java-stream/java_stream_cover.jpg" height="auto"   width="auto" ></div><div class="details series-nav open">
                                <div class="details-summary series-title">
                                    <span>Series - java-stream</span>
                                    <span><i class="details-icon fas fa-angle-right"></i></span>
                                </div>
                                <div class="details-content series-content">
                                    <nav>
                                        <ul><li><span class="active">了解Java Stream流操作</span></li></ul>
                                    </nav>
                                </div>
                            </div><div class="details toc" id="toc-static"  kept="true">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#static-class-静态类">Static Class 静态类</a>
      <ul>
        <li><a href="#静态内部类和非静态内部类的不同">静态内部类和非静态内部类的不同</a></li>
        <li><a href="#the-difference-between-comparable-and-comparator">The difference between Comparable and Comparator</a></li>
        <li><a href="#iterator-迭代器">Iterator 迭代器</a>
          <ul>
            <li><a href="#外部迭代">外部迭代</a></li>
            <li><a href="#内部迭代">内部迭代</a></li>
          </ul>
        </li>
        <li><a href="#函数式编程-stream-流">函数式编程 Stream 流</a>
          <ul>
            <li><a href="#只过滤不记数">只过滤不记数</a></li>
            <li><a href="#由于使用了惰性求值没有输出艺术家名字">由于使用了惰性求值，没有输出艺术家名字</a></li>
            <li><a href="#输出艺术家名字">输出艺术家名字</a></li>
            <li><a href="#解答">解答</a></li>
            <li><a href="#为什么要区分惰性求值和及早求值">为什么要区分惰性求值和及早求值</a></li>
          </ul>
        </li>
        <li><a href="#常用的流操作">常用的流操作</a>
          <ul>
            <li><a href="#collecttolist">collect(toList())</a></li>
            <li><a href="#map">map</a></li>
            <li><a href="#filter">filter</a></li>
            <li><a href="#flatmap">flatMap</a>
              <ul>
                <li><a href="#flatmap-和-map">flatMap 和 map</a></li>
              </ul>
            </li>
            <li><a href="#max--min">max &amp; min</a></li>
            <li><a href="#通用模式">通用模式</a></li>
            <li><a href="#reduce-聚合方法">reduce 聚合方法</a></li>
            <li><a href="#整合操作">整合操作</a></li>
          </ul>
        </li>
        <li><a href="#重构遗留代码">重构遗留代码</a></li>
        <li><a href="#多次调用流操作">多次调用流操作</a></li>
        <li><a href="#正确使用lambda表达式">正确使用Lambda表达式</a></li>
      </ul>
    </li>
    <li><a href="#类库">类库</a>
      <ul>
        <li><a href="#在代码中使用lambda表达式">在代码中使用Lambda表达式</a>
          <ul>
            <li><a href="#降低日志性能开销">降低日志性能开销</a></li>
            <li><a href="#基本类型">基本类型</a></li>
            <li><a href="#重载解析">重载解析</a></li>
            <li><a href="#functionalinterface">@FunctionalInterface</a></li>
            <li><a href="#新的语言特性默认方法">新的语言特性：默认方法</a></li>
            <li><a href="#optional">Optional</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#高级集合类和收集器">高级集合类和收集器</a>
      <ul>
        <li><a href="#方法引用">方法引用</a>
          <ul>
            <li><a href="#构造函数的缩写形式">构造函数的缩写形式</a>
              <ul>
                <li><a href="#创建对象">创建对象</a></li>
                <li><a href="#创建数组">创建数组</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#元素顺序">元素顺序</a></li>
        <li><a href="#使用收集器">使用收集器</a>
          <ul>
            <li><a href="#转换成其他集合">转换成其他集合</a></li>
            <li><a href="#转换成值">转换成值</a></li>
            <li><a href="#数据分块">数据分块</a></li>
            <li><a href="#数据分组">数据分组</a></li>
            <li><a href="#字符串">字符串</a></li>
            <li><a href="#组合收集器">组合收集器</a></li>
            <li><a href="#重构和定制收集器">重构和定制收集器</a></li>
            <li><a href="#对收集器的归一化处理">对收集器的归一化处理</a></li>
            <li><a href="#map迭代方式">Map迭代方式</a></li>
          </ul>
        </li>
        <li><a href="#补充">补充</a>
          <ul>
            <li><a href="#boxed">boxed()</a></li>
            <li><a href="#maptoint">mapToInt()</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#数据并行化">数据并行化</a>
      <ul>
        <li><a href="#并行和并发">并行和并发</a></li>
        <li><a href="#并行化的重要性">并行化的重要性</a></li>
        <li><a href="#并行化流操作">并行化流操作</a></li>
        <li><a href="#模拟系统">模拟系统</a></li>
        <li><a href="#限制">限制</a></li>
        <li><a href="#性能">性能</a></li>
        <li><a href="#并行化数组操作">并行化数组操作</a></li>
      </ul>
    </li>
    <li><a href="#测试调试重构">测试、调试、重构</a>
      <ul>
        <li><a href="#重构候选项">重构候选项</a>
          <ul>
            <li><a href="#进进出出摇摇晃晃">进进出出、摇摇晃晃</a></li>
            <li><a href="#孤独的覆盖">孤独的覆盖</a></li>
            <li><a href="#同样的东西写两遍">同样的东西写两遍</a></li>
          </ul>
        </li>
        <li><a href="#日志和打印消息">日志和打印消息</a></li>
      </ul>
    </li>
    <li><a href="#设计和架构的原则">设计和架构的原则</a>
      <ul>
        <li><a href="#lambda表达式改变了设计模式">Lambda表达式改变了设计模式</a>
          <ul>
            <li><a href="#命令者模式">命令者模式</a></li>
            <li><a href="#策略模式">策略模式</a></li>
            <li><a href="#观察者模式">观察者模式</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#new相关">New相关</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h2 id="static-class-静态类" class="headerLink">
    <a href="#static-class-%e9%9d%99%e6%80%81%e7%b1%bb" class="header-mark"></a>Static Class 静态类</h2><p>可以在一个类里面定义静态类，比如，内部类 (nested class)。把nested class封闭起来的叫外部类。只有内部类才可以static。</p>
<h3 id="静态内部类和非静态内部类的不同" class="headerLink">
    <a href="#%e9%9d%99%e6%80%81%e5%86%85%e9%83%a8%e7%b1%bb%e5%92%8c%e9%9d%9e%e9%9d%99%e6%80%81%e5%86%85%e9%83%a8%e7%b1%bb%e7%9a%84%e4%b8%8d%e5%90%8c" class="header-mark"></a>静态内部类和非静态内部类的不同</h3><ol>
<li>内部静态类不需要有指向外部类的引用，但非静态内部类需要持有对外部类的引用。</li>
<li>非静态内部类能够访问外部类的静态和非静态成员，静态类不能够访问外部类的非静态成员，智能访问外部类的静态成员。</li>
<li>非静态内部类不能够脱离外部类实体被创建，它可以访问外部类的数据和方法，因为它就在外部类里面</li>
</ol>
<h3 id="the-difference-between-comparable-and-comparator" class="headerLink">
    <a href="#the-difference-between-comparable-and-comparator" class="header-mark"></a>The difference between Comparable and Comparator</h3><p>Comparable是一个对像本身就已经支持自比较所需要实现的接口（如 String、Integer自己就可以完成比较大小操作，已经实现了该接口）。</p>
<p>Comparable接口只提供了   int   compareTo(T   o)方法，也就是说假如我定义了一个Person类，这个类实现了   Comparable接口，那么当我实例化Person类的person1后，我想比较person1和一个现有的Person对象person2的大小时，我就可以这样来调用：person1.comparTo(person2),通过返回值就可以判断了；而此时如果你定义了一个   PersonComparator（实现了Comparator接口）的话，那你就可以这样：PersonComparator   comparator=   new   PersonComparator();
comparator.compare(person1,person2)；。</p>
<p>Comparator是一个专用的比较器，当前对象不支持自比较或者自比较函数不能够满足要求时，可以写一个比较器来完成对象之间的大小比较。</p>
<p>Comparator定义了俩个方法，分别是 int compare 和 boolean equals，用于比较两个Comparator是否相等。</p>
<p>注意：有时在实现Comparator接口时，并没有实现equals方法，可程序并没有报错，原因是实现该接口的类也是Object类的子类，而Object类已经实现了equals方法.</p>
<h3 id="iterator-迭代器" class="headerLink">
    <a href="#iterator-%e8%bf%ad%e4%bb%a3%e5%99%a8" class="header-mark"></a>Iterator 迭代器</h3><p>迭代器是一种设计模式，是一个对象，遍历选择序列中的元素。</p>
<p>.next() 向下移动指针，返回下一个元素，如果没有元素，就报异常。（当调用.next()，会自动调用.remove()，也就是说迭代器遍历一次，该位置的元素会被清除）</p>
<p>.hasNext() 返回True表示有下个元素，false表示没有元素了，此时只判断下一个元素的有无，并不移动指针。</p>
<p>.remove() 删除的是指针指向的元素，当前指针没有元素，那么会抛异常。</p>
<h4 id="外部迭代" class="headerLink">
    <a href="#%e5%a4%96%e9%83%a8%e8%bf%ad%e4%bb%a3" class="header-mark"></a>外部迭代</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">traditionalIterator</span><span class="p">(</span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Artist</span><span class="o">&gt;</span><span class="w"> </span><span class="n">artList</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">0</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Iterator</span><span class="o">&lt;</span><span class="n">Artist</span><span class="o">&gt;</span><span class="w"> </span><span class="n">iterator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">artList</span><span class="p">.</span><span class="na">iterator</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">iterator</span><span class="p">.</span><span class="na">hasNext</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">iterator</span><span class="p">.</span><span class="na">hasNext</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">iterator</span><span class="p">.</span><span class="na">next</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">count</span><span class="o">++</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;外部迭代器：&#34;</span><span class="o">+</span><span class="n">count</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>使用迭代器的方法调用流程：4次</p>
<ol>
<li>hasNext() 查询 +1</li>
<li>hasNext() 返回查询值 +1</li>
<li>next() 移动指针 +1</li>
<li>next() 返回当前指针的元素值 +1</li>
</ol>
<h4 id="内部迭代" class="headerLink">
    <a href="#%e5%86%85%e9%83%a8%e8%bf%ad%e4%bb%a3" class="header-mark"></a>内部迭代</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">streamIterator</span><span class="p">(</span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Artist</span><span class="o">&gt;</span><span class="w"> </span><span class="n">artList</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">artList</span><span class="p">.</span><span class="na">stream</span><span class="p">().</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">filter</span><span class="p">(</span><span class="n">artist</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">0</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">artist</span><span class="p">.</span><span class="na">getAge</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">count</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;内部迭代器：&#34;</span><span class="o">+</span><span class="n">count</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>使用stream类库后的方法调用流程：2次</p>
<ol>
<li>构建操作</li>
<li>返回结果</li>
</ol>
<h3 id="函数式编程-stream-流" class="headerLink">
    <a href="#%e5%87%bd%e6%95%b0%e5%bc%8f%e7%bc%96%e7%a8%8b-stream-%e6%b5%81" class="header-mark"></a>函数式编程 Stream 流</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">artList</span><span class="p">.</span><span class="na">stream</span><span class="p">().</span><span class="na">filter</span><span class="p">(</span><span class="n">artist</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">0</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">artist</span><span class="p">.</span><span class="na">getAge</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kt">long</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">artList</span><span class="p">.</span><span class="na">stream</span><span class="p">().</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">filter</span><span class="p">(</span><span class="n">artist</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">0</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">artist</span><span class="p">.</span><span class="na">getAge</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">count</span><span class="p">();</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="只过滤不记数" class="headerLink">
    <a href="#%e5%8f%aa%e8%bf%87%e6%bb%a4%e4%b8%8d%e8%ae%b0%e6%95%b0" class="header-mark"></a>只过滤不记数</h4><p>像 filter 这样只描述Stream，最终不产生新集合的方法叫做<strong>惰性求值方法</strong></p>
<p>而像 count 这样最终会从 Stream 产生值的方法叫做 <strong>及早求值方法</strong>。</p>
<h4 id="由于使用了惰性求值没有输出艺术家名字" class="headerLink">
    <a href="#%e7%94%b1%e4%ba%8e%e4%bd%bf%e7%94%a8%e4%ba%86%e6%83%b0%e6%80%a7%e6%b1%82%e5%80%bc%e6%b2%a1%e6%9c%89%e8%be%93%e5%87%ba%e8%89%ba%e6%9c%af%e5%ae%b6%e5%90%8d%e5%ad%97" class="header-mark"></a>由于使用了惰性求值，没有输出艺术家名字</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// 它本身有返回值，是Stream类型，因为不需要进一步操作返回值，所以就写成这样</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">artList</span><span class="p">.</span><span class="na">stream</span><span class="p">().</span><span class="na">filter</span><span class="p">(</span><span class="n">artist</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">artist</span><span class="p">.</span><span class="na">getName</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="n">artist</span><span class="p">.</span><span class="na">getName</span><span class="p">().</span><span class="na">equals</span><span class="p">(</span><span class="s">&#34;阿凡达&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">});</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="输出艺术家名字" class="headerLink">
    <a href="#%e8%be%93%e5%87%ba%e8%89%ba%e6%9c%af%e5%ae%b6%e5%90%8d%e5%ad%97" class="header-mark"></a>输出艺术家名字</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kt">long</span><span class="w"> </span><span class="n">getName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">artList</span><span class="p">.</span><span class="na">stream</span><span class="p">().</span><span class="na">filter</span><span class="p">(</span><span class="n">artist</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">artist</span><span class="p">.</span><span class="na">getName</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="n">artist</span><span class="p">.</span><span class="na">getName</span><span class="p">().</span><span class="na">equals</span><span class="p">(</span><span class="s">&#34;阿凡达&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}).</span><span class="na">count</span><span class="p">();</span><span class="w"> 
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>输出结果：将集合中所有的元素都打印出来，和return返回什么无关，只是打印getName。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">阿凡达</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">奇异博士</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>前面两个区别，前者是惰性求值（个人理解是没有返回），因此不会打印。而同样的语句在后者，因为加入了一个终止操作的流，就比如记数操作，名字就被会打印。（<strong>不懂其原理</strong>）</p>
<h4 id="解答" class="headerLink">
    <a href="#%e8%a7%a3%e7%ad%94" class="header-mark"></a>解答</h4><p>判断一个操作是惰性求值还是及早求值的方法，关注其返回值</p>
<ol>
<li>返回值是Stream就是惰性操作。（不会展示打印内容）</li>
<li>返回值是其它类型或者空，就是及早操作。（会展示打印内容）</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Stream</span><span class="o">&lt;</span><span class="n">Artist</span><span class="o">&gt;</span><span class="w"> </span><span class="n">getNameStream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">artList</span><span class="p">.</span><span class="na">stream</span><span class="p">().</span><span class="na">filter</span><span class="p">(</span><span class="n">artist</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">artist</span><span class="p">.</span><span class="na">getName</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="n">artist</span><span class="p">.</span><span class="na">getName</span><span class="p">().</span><span class="na">equals</span><span class="p">(</span><span class="s">&#34;阿凡达&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kt">long</span><span class="w"> </span><span class="n">getName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">artList</span><span class="p">.</span><span class="na">stream</span><span class="p">().</span><span class="na">filter</span><span class="p">(</span><span class="n">artist</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">artist</span><span class="p">.</span><span class="na">getName</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="n">artist</span><span class="p">.</span><span class="na">getName</span><span class="p">().</span><span class="na">equals</span><span class="p">(</span><span class="s">&#34;阿凡达&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}).</span><span class="na">count</span><span class="p">();</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>使用这些操作的理想方式是形成一个惰性求值的链，最后用一个及早求值的操作返回想要的结果，这正是它的合理之处。</p>
<p>整个过程和建造者模式有共同之处。建造者模式使用一系列操作设置属性和配置，最后调用一个build方法，这时，对象才被真正创建。</p>
<h4 id="为什么要区分惰性求值和及早求值" class="headerLink">
    <a href="#%e4%b8%ba%e4%bb%80%e4%b9%88%e8%a6%81%e5%8c%ba%e5%88%86%e6%83%b0%e6%80%a7%e6%b1%82%e5%80%bc%e5%92%8c%e5%8f%8a%e6%97%a9%e6%b1%82%e5%80%bc" class="header-mark"></a>为什么要区分惰性求值和及早求值</h4><p>只有在对需要什么样的结果和操作有了了解后，才能更有效率地进行计算。</p>
<p>比如，如果要找到大于10的第一个数，并不需要和所与元素进行不交，只需要找到第一个匹配的元素即可。这意味着可以在集合类上级联多种操作，但迭代只需要一次。</p>
<h3 id="常用的流操作" class="headerLink">
    <a href="#%e5%b8%b8%e7%94%a8%e7%9a%84%e6%b5%81%e6%93%8d%e4%bd%9c" class="header-mark"></a>常用的流操作</h3><h4 id="collecttolist" class="headerLink">
    <a href="#collecttolist" class="header-mark"></a>collect(toList())</h4><p>collect(toList()) 方法由Stream里的值生成要给列表，是一个及早求值操作。</p>
<p>Stream的of方法使用一组初始值生成新的Stream。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// 创建List</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Stream</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="s">&#34;a&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;b&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;c&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;d&#34;</span><span class="p">).</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">toList</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// 方式2 该方法应该是上面的进化版，更简洁</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Stream</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="s">&#34;a&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;b&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;c&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;d&#34;</span><span class="p">).</span><span class="na">toList</span><span class="p">();</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>首先由列表生成一个Stream，然后进行一个Stream上的操作，继而是collect操作，由Stream声称列表。</p>
<h4 id="map" class="headerLink">
    <a href="#map" class="header-mark"></a>map</h4><p>如果有一个函数可以将一种类型的值转换成另外一种类型，map操作就可以使用该函数，讲一个流中的值转成一个新的流。</p>
<p>比如，将一组字符串转换成大写形式，传统方式是在循环中对每个字符串调用 toUppercase方法，然后将得到的结果加入到一个新的列表。</p>
<p>传统小写变大写的方法</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">collected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">asList</span><span class="p">(</span><span class="s">&#34;a&#34;</span><span class="p">,</span><span class="s">&#34;b&#34;</span><span class="p">,</span><span class="s">&#34;hello&#34;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">str</span><span class="p">.</span><span class="na">toUpperCase</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">collected</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">s</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">···</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Stream小写变大写</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">```</span><span class="n">java</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">collect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Stream</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="s">&#34;a&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;b&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;hello&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">str</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">str</span><span class="p">.</span><span class="na">toUpperCase</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">toList</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// 简洁版</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">collect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Stream</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="s">&#34;a&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;b&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;hello&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">String</span><span class="p">::</span><span class="n">toUpperCase</span><span class="p">).</span><span class="na">toList</span><span class="p">();</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>传给map的Lambda表达式只接受一个String类型的参数，返回一个新的String。参数和返回值不必属于同一种类型，但是Lambda表达式必须是Function接口的一个实例，Function接口是只包含一个参数的普通函数接口。</p>
<h4 id="filter" class="headerLink">
    <a href="#filter" class="header-mark"></a>filter</h4><p>遍历数据并检查其中的元素时，可以尝试使用filter。主要作用就是筛选出有用的信息。</p>
<p>例：找出一组字符串中以数字开头的字符串，</p>
<p>传统方法：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">asList</span><span class="p">(</span><span class="s">&#34;a&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;1a&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;a1&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;2b&#34;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Character</span><span class="p">.</span><span class="na">isDigit</span><span class="p">(</span><span class="n">str</span><span class="p">.</span><span class="na">charAt</span><span class="p">(</span><span class="n">0</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">list</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">str</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Stream流方式：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Stream</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="s">&#34;a&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;1a&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;a1&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;2b&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">filter</span><span class="p">(</span><span class="n">s</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Character</span><span class="p">.</span><span class="na">isDigit</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="na">charAt</span><span class="p">(</span><span class="n">0</span><span class="p">)))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">toList</span><span class="p">();</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>和map很像，filter接受要给函数作为参数，该函数用Lambda表达式表示。如果for循环中的if条件芋圆可以被filter代替。他们的返回值都是true或false，来过滤Stream中符合条件的。</p>
<h4 id="flatmap" class="headerLink">
    <a href="#flatmap" class="header-mark"></a>flatMap</h4><p>flatMap可以将一个类中不同属性但是同类型的元素装载到一个Stream中，但是map做不到</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">list</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">flatMap</span><span class="p">(</span><span class="n">artist</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Stream</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">art</span><span class="p">.</span><span class="na">getName</span><span class="p">(),</span><span class="w"> </span><span class="n">art</span><span class="p">.</span><span class="na">getNationality</span><span class="p">()))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">toList</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">list</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">artist</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">artist</span><span class="p">.</span><span class="na">getName</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">toList</span><span class="p">();</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>这样返回的集合就是说我们想要的艺术家的年龄的集合。</p>
<h5 id="flatmap-和-map" class="headerLink">
    <a href="#flatmap-%e5%92%8c-map" class="header-mark"></a>flatMap 和 map</h5><p>map可用一个新的值代替Stream中的值。而flatMap是生成新的Stream对象取代之前，或者是之前都n个流对象，flatMap将他们整合后变成一个。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">together</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Stream</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">asList</span><span class="p">(</span><span class="n">1</span><span class="p">,</span><span class="w"> </span><span class="n">2</span><span class="p">),</span><span class="w"> </span><span class="n">asList</span><span class="p">(</span><span class="n">3</span><span class="p">,</span><span class="w"> </span><span class="n">4</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">flatMap</span><span class="p">(</span><span class="n">numbers</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">numbers</span><span class="p">.</span><span class="na">stream</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">toList</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// Idea推荐写法</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">together</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Stream</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">asList</span><span class="p">(</span><span class="n">1</span><span class="p">,</span><span class="w"> </span><span class="n">2</span><span class="p">),</span><span class="w"> </span><span class="n">asList</span><span class="p">(</span><span class="n">3</span><span class="p">,</span><span class="w"> </span><span class="n">4</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">flatMap</span><span class="p">(</span><span class="n">Collection</span><span class="p">::</span><span class="n">stream</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">toList</span><span class="p">();</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="max--min" class="headerLink">
    <a href="#max--min" class="header-mark"></a>max &amp; min</h4><p>求最值</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// 书中给出的写法</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Artist</span><span class="w"> </span><span class="n">minArtistAge1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">list</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">min</span><span class="p">(</span><span class="n">Comparator</span><span class="p">.</span><span class="na">comparing</span><span class="p">(</span><span class="n">artist</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">artist</span><span class="p">.</span><span class="na">getAge</span><span class="p">()))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">get</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// Idea推荐写法</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Artist</span><span class="w"> </span><span class="n">minArtistAge1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">list</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">min</span><span class="p">(</span><span class="n">Comparator</span><span class="p">.</span><span class="na">comparing</span><span class="p">(</span><span class="n">Artist</span><span class="p">::</span><span class="n">getAge</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">get</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Artist</span><span class="w"> </span><span class="n">maxArtistAge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">list</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">max</span><span class="p">(</span><span class="n">Comparator</span><span class="p">.</span><span class="na">comparing</span><span class="p">(</span><span class="n">Artist</span><span class="p">::</span><span class="n">getAge</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">get</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">Artist</span><span class="o">&gt;</span><span class="w"> </span><span class="n">max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">list</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">max</span><span class="p">(</span><span class="n">Comparator</span><span class="p">.</span><span class="na">comparing</span><span class="p">(</span><span class="n">Artist</span><span class="p">::</span><span class="n">getAge</span><span class="p">));</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>排序的时候需要用到 Comparator 比较器对象。Java8中提供了新的静态方法 comparing()，使用它可以方便地实现一个比较器。之前需要比较两个对象的某个属性值。现在一个存取方法就够了。</p>
<ul>
<li>需要深入研究comparing方法，该方法接受一个函数并返回另一个函数，该方法本该早已加入Java标准库，但是由于匿名内部类可读性差且书写冗长，一直未实现。现在在Lambda表达式，可以简单的完成。</li>
</ul>
<p>调用空Stream的max/min方法，返回的是Optional对象，它代表一个可能存在也可能不存在的值。它里面的实际的值就是我们要得到的对象是在 .max().get() / .min()/get() 得到的。</p>
<h4 id="通用模式" class="headerLink">
    <a href="#%e9%80%9a%e7%94%a8%e6%a8%a1%e5%bc%8f" class="header-mark"></a>通用模式</h4><p>max和min方法都属于更通用的一种编程模式</p>
<p>使用for循环重写上面的代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">List</span><span class="o">&lt;</span><span class="n">Artist</span><span class="o">&gt;</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">List</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Artist</span><span class="p">(</span><span class="n">11</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;China&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;Sam&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">new</span><span class="w"> </span><span class="n">Artist</span><span class="p">(</span><span class="n">9</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;UK&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;Die&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">new</span><span class="w"> </span><span class="n">Artist</span><span class="p">(</span><span class="n">22</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;US&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;Daming&#34;</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Artist</span><span class="w"> </span><span class="n">artist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">list</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">0</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">for</span><span class="p">(</span><span class="n">Artist</span><span class="w"> </span><span class="n">obj</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">list</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="na">getAge</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">artist</span><span class="p">.</span><span class="na">getAge</span><span class="p">()){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">artist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obj</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="reduce-聚合方法" class="headerLink">
    <a href="#reduce-%e8%81%9a%e5%90%88%e6%96%b9%e6%b3%95" class="header-mark"></a>reduce 聚合方法</h4><p>加减乘除都行。把Stream的所有的元素按照聚合函数聚合成一个结果</p>
<p>传统reduce模式：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">numbers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">List</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">1</span><span class="p">,</span><span class="w"> </span><span class="n">2</span><span class="p">,</span><span class="w"> </span><span class="n">3</span><span class="p">,</span><span class="w"> </span><span class="n">4</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Integer</span><span class="w"> </span><span class="n">accumulator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">0</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">for</span><span class="p">(</span><span class="n">Integer</span><span class="w"> </span><span class="n">element</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">numbers</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">accumulator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">accumulator</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Stream中reduce模式：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Integer</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Stream</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">1</span><span class="p">,</span><span class="w"> </span><span class="n">2</span><span class="p">,</span><span class="w"> </span><span class="n">3</span><span class="p">,</span><span class="w"> </span><span class="n">4</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">reduce</span><span class="p">(</span><span class="n">0</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">acc</span><span class="p">,</span><span class="w"> </span><span class="n">element</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">acc</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">element</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// idea推荐写法，0表示和列表中进行计算的数字，Integer表示类型，sum表示计算方式</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Integer</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Stream</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">1</span><span class="p">,</span><span class="w"> </span><span class="n">2</span><span class="p">,</span><span class="w"> </span><span class="n">3</span><span class="p">,</span><span class="w"> </span><span class="n">4</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">reduce</span><span class="p">(</span><span class="n">0</span><span class="p">,</span><span class="w"> </span><span class="n">Integer</span><span class="p">::</span><span class="n">sum</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">展开reduce操作</span><span class="err">：</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">```</span><span class="n">java</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// 在这定义两个元素是相加的</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">BinaryOperator</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">accumulator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">acc</span><span class="p">,</span><span class="w"> </span><span class="n">element</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">acc</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">element</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// 或者</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">BinaryOperator</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">accumulator1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Integer</span><span class="p">::</span><span class="n">sum</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// 这里给accumulator添加元素，apply里就是两个元素</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// 这两个元素会按照accumulator中的运算法则进行运算</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kt">int</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">accumulator1</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">accumulator1</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">accumulator1</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="n">accumulator1</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">0</span><span class="p">,</span><span class="w"> </span><span class="n">1</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="n">2</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">3</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">4</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Reduce参数</strong>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Performs</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">reduction</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">elements</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">stream</span><span class="p">,</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">provided</span><span class="w"> </span><span class="n">identity</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">associative</span><span class="w"> </span><span class="n">accumulation</span><span class="w"> </span><span class="n">function</span><span class="p">,</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">returns</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">reduced</span><span class="w"> </span><span class="n">value</span><span class="p">.</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">equivalent</span><span class="w"> </span><span class="n">to</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">identity</span><span class="p">;</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">T</span><span class="w"> </span><span class="n">element</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">stream</span><span class="p">)</span><span class="w">      
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">accumulator</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="n">element</span><span class="p">)</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">but</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">constrained</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">execute</span><span class="w"> </span><span class="n">sequentially</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">The</span><span class="w"> </span><span class="n">identity</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">identity</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">accumulator</span><span class="w"> </span><span class="n">function</span><span class="p">.</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">means</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">accumulator</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">identity</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">equal</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">accumulator</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">associative</span><span class="w"> </span><span class="n">function</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">This</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">terminal</span><span class="w"> </span><span class="n">operation</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nl">Params</span><span class="p">:</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">identity</span><span class="w"> </span><span class="err">–</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">identity</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">accumulating</span><span class="w"> </span><span class="n">function</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">accumulator</span><span class="w"> </span><span class="err">–</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">associative</span><span class="p">,</span><span class="w"> </span><span class="n">non</span><span class="o">-</span><span class="n">interfering</span><span class="p">,</span><span class="w"> </span><span class="n">stateless</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">combining</span><span class="w"> </span><span class="n">two</span><span class="w"> </span><span class="n">values</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nl">Returns</span><span class="p">:</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">reduction</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">API</span><span class="w"> </span><span class="n">Note</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Sum</span><span class="p">,</span><span class="w"> </span><span class="n">min</span><span class="p">,</span><span class="w"> </span><span class="n">max</span><span class="p">,</span><span class="w"> </span><span class="n">average</span><span class="p">,</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="n">concatenation</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">special</span><span class="w"> </span><span class="n">cases</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">reduction</span><span class="p">.</span><span class="w"> </span><span class="n">Summing</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">stream</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">numbers</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">expressed</span><span class="w"> </span><span class="n">as</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">integers</span><span class="p">.</span><span class="na">reduce</span><span class="p">(</span><span class="n">0</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nl">or</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">integers</span><span class="p">.</span><span class="na">reduce</span><span class="p">(</span><span class="n">0</span><span class="p">,</span><span class="w"> </span><span class="n">Integer</span><span class="p">::</span><span class="n">sum</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">While</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">seem</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">roundabout</span><span class="w"> </span><span class="n">way</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">perform</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">aggregation</span><span class="w"> </span><span class="n">compared</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">simply</span><span class="w"> </span><span class="n">mutating</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">running</span><span class="w"> </span><span class="n">total</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">loop</span><span class="p">,</span><span class="w"> </span><span class="n">reduction</span><span class="w"> </span><span class="n">operations</span><span class="w"> </span><span class="n">parallelize</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">gracefully</span><span class="p">,</span><span class="w"> </span><span class="n">without</span><span class="w"> </span><span class="n">needing</span><span class="w"> </span><span class="n">additional</span><span class="w"> </span><span class="n">synchronization</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">greatly</span><span class="w"> </span><span class="n">reduced</span><span class="w"> </span><span class="n">risk</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">races</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">T</span><span class="w"> </span><span class="nf">reduce</span><span class="p">(</span><span class="n">T</span><span class="w"> </span><span class="n">identity</span><span class="p">,</span><span class="w"> </span><span class="n">BinaryOperator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">accumulator</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>需要传入两个参数，其中第一个参数，identity，表示的是初始值，以它为基础开始运算。</li>
<li>第二个参数 accumulator，类型是 BinaryOperator&lt;T&gt; ，它继承了 Bifunction&lt;T,T,T&gt;，而它当中有一个 apply的方法。他们每次操作两个元素。</li>
</ul>
<h4 id="整合操作" class="headerLink">
    <a href="#%e6%95%b4%e5%90%88%e6%93%8d%e4%bd%9c" class="header-mark"></a>整合操作</h4><p>Stream接口的方法很多，让人难以选择，本节举例说明如何将问题分解为简单的stream操作。</p>
<p>问题1：找到某张专辑上所有乐队的国籍。艺术家列表中既有个人也有乐队。</p>
<p>将问题分解为如此几个步骤：</p>
<ol>
<li>找出专辑上的所有表演者 ——&gt; 目标对象有个getMusicians方法，返回一个Stream对象，包含所有的表演者</li>
<li>分辨哪些是乐队 ——&gt; filter方法对表演者过滤，只保留乐队，具体方法可以筛选以The为开头的（打个比方）</li>
<li>找出每个乐队的国籍 ——&gt; map方法将乐队映射为其所属国家</li>
<li>将找到的的国籍放入一个集合 ——&gt; .toList)()方法将国籍放入一个集合</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">getNationalities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">album</span><span class="p">.</span><span class="na">getMusicians</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">filter</span><span class="p">(</span><span class="n">artist</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">artist</span><span class="p">.</span><span class="na">getName</span><span class="p">().</span><span class="na">startsWith</span><span class="p">(</span><span class="s">&#34;The&#34;</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">artist</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">artist</span><span class="p">.</span><span class="na">getNationality</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">toList</span><span class="p">();</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>这个例子将链式操作展现的淋漓尽致，调用filter, map都返回Stream对象，因此属于惰性求值，而toList()属于及早求值。map方法接受一个Lambda表达式，使用该Lambda表达式对Stream上的每一个元素做映射，形成一个新的Stream。</p>
<p>思考，真的需要对外暴露一个List或Set对象么？通过Stream暴露集合的最大优点在于，它很好地封装了内部实现的诗句结构。仅暴露一个Stream接口，在实际操作中用户无论如何操作，都不会影响到内部的List或Set。</p>
<h3 id="重构遗留代码" class="headerLink">
    <a href="#%e9%87%8d%e6%9e%84%e9%81%97%e7%95%99%e4%bb%a3%e7%a0%81" class="header-mark"></a>重构遗留代码</h3><p>传统的代码</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findLongTracls</span><span class="p">(</span><span class="n">LList</span><span class="o">&lt;</span><span class="n">Album</span><span class="o">&gt;</span><span class="w"> </span><span class="n">albums</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">trackNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashSet</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="n">Album</span><span class="w"> </span><span class="n">album</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">albums</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">for</span><span class="p">(</span><span class="n">Track</span><span class="w"> </span><span class="n">track</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">album</span><span class="p">.</span><span class="na">getTrackList</span><span class="p">()){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="k">if</span><span class="p">(</span><span class="n">track</span><span class="p">.</span><span class="na">getLength</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">60</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">track</span><span class="p">.</span><span class="na">getName</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="n">trackNames</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">name</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Stream重构</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findLongTracks</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Album</span><span class="o">&gt;</span><span class="w"> </span><span class="n">albums</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">trackNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashSet</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">albums</span><span class="p">.</span><span class="na">forEach</span><span class="p">(</span><span class="n">album</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="n">album</span><span class="p">.</span><span class="na">getTracks</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="p">.</span><span class="na">forEach</span><span class="p">(</span><span class="n">track</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                        </span><span class="k">if</span><span class="p">(</span><span class="n">track</span><span class="p">.</span><span class="na">getLength</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">60</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                                </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">track</span><span class="p">.</span><span class="na">getName</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                                </span><span class="n">trackNames</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">name</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">trackNames</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>对比发现重构后的代码的可读性比之前的代码还差。</p>
<p>分析：最内层的foreach的作用：</p>
<ol>
<li>找出长度大于1的曲目</li>
<li>得到符合条件的曲目名称</li>
<li>将其添加到Set</li>
</ol>
<p>这意味着需要三项Stream操作，找到满足条件的纠结过是 filter功能，得到曲目名称可以用map，最终使用forEach将曲目添加到filter功能。</p>
<p>重构2：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findLongTracks</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Album</span><span class="o">&gt;</span><span class="w"> </span><span class="n">albums</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">trackNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashSet</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">albums</span><span class="p">.</span><span class="na">forEach</span><span class="p">(</span><span class="n">album</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">album</span><span class="p">.</span><span class="na">getTracks</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">filter</span><span class="p">(</span><span class="n">track</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">track</span><span class="p">.</span><span class="na">getLength</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">60</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">track</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">track</span><span class="p">.</span><span class="na">getName</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">forEach</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">tracksNames</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">name</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">trackNames</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>代码看着还是冗余，继续改：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findLongTracks</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Album</span><span class="o">&gt;</span><span class="w"> </span><span class="n">albums</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">trackNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashSet</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">albums</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">flatMap</span><span class="p">(</span><span class="n">album</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">album</span><span class="p">.</span><span class="na">getTracks</span><span class="p">()))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">filter</span><span class="p">(</span><span class="n">track</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">track</span><span class="p">.</span><span class="na">getLength</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">60</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">track</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">track</span><span class="p">.</span><span class="na">getName</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">forEach</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">trackNames</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">name</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">trackNames</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>上面代码已经替换了两个嵌套的for循环，看起来清晰很多，但是并未及家属，仍需要手动创建一个Set对象并将其加入到其中，下面将通过Stream完成。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findLongTracks</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Album</span><span class="o">&gt;</span><span class="w"> </span><span class="n">albums</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">albums</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">flatMap</span><span class="p">(</span><span class="n">album</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">album</span><span class="p">.</span><span class="na">getTracks</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">filter</span><span class="p">(</span><span class="n">track</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">track</span><span class="p">.</span><span class="na">getLength</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">60</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">track</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">track</span><span class="p">.</span><span class="na">getName</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">toSet</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>上述步骤中没有提到一个重点，就是每一步代码都要编写单元测试。</p>
<h3 id="多次调用流操作" class="headerLink">
    <a href="#%e5%a4%9a%e6%ac%a1%e8%b0%83%e7%94%a8%e6%b5%81%e6%93%8d%e4%bd%9c" class="header-mark"></a>多次调用流操作</h3><p>虽然可以选择每一步强制对函数求值，而不是所有的方法调用连接在一起，但是最好不要这么做。(能写在一起就不要分开写几行)。</p>
<h3 id="正确使用lambda表达式" class="headerLink">
    <a href="#%e6%ad%a3%e7%a1%ae%e4%bd%bf%e7%94%a8lambda%e8%a1%a8%e8%be%be%e5%bc%8f" class="header-mark"></a>正确使用Lambda表达式</h3><p>明确了要达成什么转化，而不是说明如何转化。其另一层含义在于写出的函数没有副作用。没有副作用的函数不会改变程序或外界的状态。比如，向控制台输出了信息，就是一个可观测到的副作用。</p>
<p>下面代码有无副作用？</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">private</span><span class="w"> </span><span class="n">ActionEvent</span><span class="w"> </span><span class="n">lastEvent</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">registerHandler</span><span class="p">(){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">button</span><span class="p">.</span><span class="na">addActionListener</span><span class="p">((</span><span class="n">ActionEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">this</span><span class="p">.</span><span class="na">lastEvent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">event</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">})</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>这里将参数event保存至成员变量lastEvent。给变量赋值也是一种副作用，而且更难察觉。的确是改变了程序的状态。</p>
<p>程序鼓励用户使用Lambda表达式获取值而不是变量。获取值使用户更容易写出没有副作用的代码。</p>
<p>无论何时，将Lambda表达式传给Stream上的高阶函数，都应该尽量避免副作用，除了forEach，因为它是一个终结方法。</p>
<h2 id="类库" class="headerLink">
    <a href="#%e7%b1%bb%e5%ba%93" class="header-mark"></a>类库</h2><h3 id="在代码中使用lambda表达式" class="headerLink">
    <a href="#%e5%9c%a8%e4%bb%a3%e7%a0%81%e4%b8%ad%e4%bd%bf%e7%94%a8lambda%e8%a1%a8%e8%be%be%e5%bc%8f" class="header-mark"></a>在代码中使用Lambda表达式</h3><h4 id="降低日志性能开销" class="headerLink">
    <a href="#%e9%99%8d%e4%bd%8e%e6%97%a5%e5%bf%97%e6%80%a7%e8%83%bd%e5%bc%80%e9%94%80" class="header-mark"></a>降低日志性能开销</h4><h4 id="基本类型" class="headerLink">
    <a href="#%e5%9f%ba%e6%9c%ac%e7%b1%bb%e5%9e%8b" class="header-mark"></a>基本类型</h4><p>基本类型对应着装箱类型，int - Integer。后者是java的普通类，是对基本类的封装。</p>
<p>Java泛型是基于对泛型参数类型的擦除。只有装箱类型才能作为泛型参数，基本类型不可以。</p>
<p>但是装箱类型是对象，这表示在内存中存在额外的开销。比如，整型的在内存中占用4字节，整形对象却占16字节。数组这一情况更严重，整型对象数组中，每个元素都是内存的一个指针，只想堆中某个对象。最坏情况，同样的数组，Integer[] 要比 int[] 多占用6倍内存。</p>
<p>而二者互相转换的过程称为装箱和拆箱，过程中都需要额外的计算开销，会影响程序运行速度。</p>
<p>Stream类中某些方法对基本类型和装箱类型做了区分，进而减小些性能开销。</p>
<p>命名规范，返回类型为基本类型，则在基本类型前加To。参数是基本型，则就直接基本类型即可。比如：ToLongFunction 和 LongFunction。</p>
<p>这些处理基本类型线管的Stream和一半的Stream是有区别的，比如LongStream。而这类特殊的Stream中的map方法的实现方式也不同，它接受的是一个LongUnaryOperator函数，将一个长整型映射成另一个长整型值。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">example1</span><span class="p">(){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Artist</span><span class="o">&gt;</span><span class="w"> </span><span class="n">artists</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">List</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Artist</span><span class="p">(</span><span class="n">11</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;China&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;Sam&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">new</span><span class="w"> </span><span class="n">Artist</span><span class="p">(</span><span class="n">9</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;UK&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;Die&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">new</span><span class="w"> </span><span class="n">Artist</span><span class="p">(</span><span class="n">22</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;US&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;Daming&#34;</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="n">IntSummaryStatistics</span><span class="w"> </span><span class="n">intSummaryStatistics</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">artists</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="p">.</span><span class="na">mapToInt</span><span class="p">(</span><span class="n">Artist</span><span class="p">::</span><span class="n">getAge</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="p">.</span><span class="na">summaryStatistics</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">printf</span><span class="p">(</span><span class="s">&#34;Max: %d, Min: %d. Ave: %f, Sum: %d&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="n">intSummaryStatistics</span><span class="p">.</span><span class="na">getMax</span><span class="p">(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="n">intSummaryStatistics</span><span class="p">.</span><span class="na">getMin</span><span class="p">(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="n">intSummaryStatistics</span><span class="p">.</span><span class="na">getAverage</span><span class="p">(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="n">intSummaryStatistics</span><span class="p">.</span><span class="na">getSum</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="重载解析" class="headerLink">
    <a href="#%e9%87%8d%e8%bd%bd%e8%a7%a3%e6%9e%90" class="header-mark"></a>重载解析</h4><p>Lambda表达式作为参数时，其类型由它的目标类型推导得出，遵循如下规则：</p>
<ul>
<li>如果只有一个可能的目标类型，由相应函数接口里的参数类型推导得出；</li>
<li>如果有多个可能的目标类型，由最具体的类型推导得出；</li>
<li>如果有多个可能的目标类型且最具体的类型不明确，则需要认为指定类型。</li>
</ul>
<h4 id="functionalinterface" class="headerLink">
    <a href="#functionalinterface" class="header-mark"></a>@FunctionalInterface</h4><p>实际上，每个用作函数接口的接口都应该添加这个注释。该注释糊强制javac检查一个接口是否符合函数接口的标准。</p>
<p>如果该注释添加给一个枚举类型、类或另一个注释，或者接口包含不止一个抽象方法，javac就会报错。</p>
<p>重构代码时，使用它很容易发现问题。</p>
<h4 id="新的语言特性默认方法" class="headerLink">
    <a href="#%e6%96%b0%e7%9a%84%e8%af%ad%e8%a8%80%e7%89%b9%e6%80%a7%e9%bb%98%e8%ae%a4%e6%96%b9%e6%b3%95" class="header-mark"></a>新的语言特性：默认方法</h4><p>为了保证二进制接口的兼容性而出现的。</p>
<p>新关键字: default，这个关键字告诉javac，用户真正需要的是为接口添加一个新方法，从而进行区分。</p>
<p>三定律：</p>
<ul>
<li>类胜于接口。如果在继承链中有方法体或抽象的方法声明，那么就可以忽略接口中定义的方法。（让代码向后兼容）</li>
<li>子类胜于父类。如果一个接口继承了另一个接口，且两个接口都定义了一个默认方法，那么子类定义的方法胜出。</li>
<li>如果上面两个规则不适用，子类要么需要实现该方法，要么将该方法声明为抽象方法。</li>
</ul>
<h4 id="optional" class="headerLink">
    <a href="#optional" class="header-mark"></a>Optional</h4><p>reduce方法有一个重点，它有两种形式：</p>
<ol>
<li>需要有一个初始值，上面有例子。</li>
<li>不需要有初始值，reduce第一步使用Stream中的前两个元素，此时返回一个Optinal对象。</li>
</ol>
<p>Optional用来替换null值，因为null最大的问题在于NullPointerException。</p>
<p>Optional两个目的，鼓励程序员适时检查变量是否为空，避免代码缺陷；二它将是一个类的API中可能为空的值文档化，这比阅读实现代码要简单的多。</p>
<p>使用方式，在调用get之前，先使用 isPresent()检查Optional对象是否有值，或者用 orElse()。</p>
<h2 id="高级集合类和收集器" class="headerLink">
    <a href="#%e9%ab%98%e7%ba%a7%e9%9b%86%e5%90%88%e7%b1%bb%e5%92%8c%e6%94%b6%e9%9b%86%e5%99%a8" class="header-mark"></a>高级集合类和收集器</h2><h3 id="方法引用" class="headerLink">
    <a href="#%e6%96%b9%e6%b3%95%e5%bc%95%e7%94%a8" class="header-mark"></a>方法引用</h3><p>Lambda通常表示方式：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">artist</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">artist</span><span class="p">.</span><span class="na">getName</span><span class="p">()</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>方法引用是一种简写语法：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nl">Artist</span><span class="p">::</span><span class="n">getName</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>标准语法为：Classname::methodName</p>
<p>注意：虽然是方法，但是不需要在后面加括号，因为这不属于调用，这是方法引用，当需要的时候，系统会自动调用。</p>
<h4 id="构造函数的缩写形式" class="headerLink">
    <a href="#%e6%9e%84%e9%80%a0%e5%87%bd%e6%95%b0%e7%9a%84%e7%bc%a9%e5%86%99%e5%bd%a2%e5%bc%8f" class="header-mark"></a>构造函数的缩写形式</h4><h5 id="创建对象" class="headerLink">
    <a href="#%e5%88%9b%e5%bb%ba%e5%af%b9%e8%b1%a1" class="header-mark"></a>创建对象</h5><p>Lambda方式：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">nationality</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Artist</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">nationality</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>方法引用</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nl">Artist</span><span class="p">::</span><span class="k">new</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h5 id="创建数组" class="headerLink">
    <a href="#%e5%88%9b%e5%bb%ba%e6%95%b0%e7%bb%84" class="header-mark"></a>创建数组</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">String</span><span class="o">[]</span><span class="p">::</span><span class="k">new</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="元素顺序" class="headerLink">
    <a href="#%e5%85%83%e7%b4%a0%e9%a1%ba%e5%ba%8f" class="header-mark"></a>元素顺序</h3><p>集合类的内容是流中的元素以何种顺序排列，比如顺序list；无序hashset。增加了流操作后，顺序问题变得更加复杂。</p>
<p>直观上，流是有序的，因为流中的元素都是按照顺序处理的，这叫做出现顺序。它依赖于数据源和对流的操作。</p>
<p>在有序集合中创建流，流中元素就是有序的。集合本身是无序的，生成的流则也是。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">numbers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">asList</span><span class="p">(</span><span class="n">1</span><span class="p">,</span><span class="n">2</span><span class="p">,</span><span class="n">3</span><span class="p">,</span><span class="n">4</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">sameOder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numbers</span><span class="p">.</span><span class="na">stream</span><span class="p">().</span><span class="na">toList</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Set</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">numbers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashSet</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">asList</span><span class="p">(</span><span class="n">4</span><span class="p">,</span><span class="n">3</span><span class="p">,</span><span class="n">2</span><span class="p">,</span><span class="n">1</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">sameOder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numbers</span><span class="p">.</span><span class="na">stream</span><span class="p">().</span><span class="na">toList</span><span class="p">();</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>无序集合生成出现顺序</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Java" data-lang="Java"><span class="line"><span class="cl"><span class="n">Set</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">numbers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newHashSet</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">asList</span><span class="p">(</span><span class="n">4</span><span class="p">,</span><span class="n">3</span><span class="p">,</span><span class="n">2</span><span class="p">,</span><span class="n">1</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// 流中选择排序</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">sameOder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numbers</span><span class="p">.</span><span class="na">stream</span><span class="p">().</span><span class="na">sorted</span><span class="p">().</span><span class="na">toList</span><span class="p">();</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="使用收集器" class="headerLink">
    <a href="#%e4%bd%bf%e7%94%a8%e6%94%b6%e9%9b%86%e5%99%a8" class="header-mark"></a>使用收集器</h3><p>从java.until.stream.Collectors类中导入</p>
<h4 id="转换成其他集合" class="headerLink">
    <a href="#%e8%bd%ac%e6%8d%a2%e6%88%90%e5%85%b6%e4%bb%96%e9%9b%86%e5%90%88" class="header-mark"></a>转换成其他集合</h4><p>收集器生成其他集合，比如 toList、toSet、toCollection。</p>
<p>通常情况创建集合需要指定具体类型：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">strList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>而toList或toSet不需要指定具体类型。Stream会组动挑选合适的类型。</p>
<p>指定集合类型：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">stream</span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">toCollection</span><span class="p">(</span><span class="n">TreeSet</span><span class="p">::</span><span class="k">new</span><span class="p">));</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="转换成值" class="headerLink">
    <a href="#%e8%bd%ac%e6%8d%a2%e6%88%90%e5%80%bc" class="header-mark"></a>转换成值</h4><p>maxBy 和 minBy 允许用户按照特定的顺序生成值。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">Artist</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">biggestGroup</span><span class="p">(</span><span class="n">Stream</span><span class="o">&lt;</span><span class="n">Artist</span><span class="o">&gt;</span><span class="w"> </span><span class="n">artists</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Function</span><span class="o">&lt;</span><span class="n">Artist</span><span class="p">,</span><span class="w"> </span><span class="n">Long</span><span class="o">&gt;</span><span class="w"> </span><span class="n">getCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">artist</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">artist</span><span class="p">.</span><span class="na">getMembers</span><span class="p">().</span><span class="na">count</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">artists</span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">maxBy</span><span class="p">(</span><span class="n">comparing</span><span class="p">(</span><span class="n">getCount</span><span class="p">)));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 也可以是</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">artists</span><span class="p">.</span><span class="na">max</span><span class="p">(</span><span class="n">comparing</span><span class="p">(</span><span class="n">getCount</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w"> 
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>求平均值</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Double</span><span class="w"> </span><span class="n">collect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">artList</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">averagingInt</span><span class="p">(</span><span class="n">Artist</span><span class="p">::</span><span class="n">getAge</span><span class="p">));</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="数据分块" class="headerLink">
    <a href="#%e6%95%b0%e6%8d%ae%e5%88%86%e5%9d%97" class="header-mark"></a>数据分块</h4><p>将其分解成两个集合。假设有一个A流，将其分为B流和C流，可以通过两次过滤操作得到两种流。但问题是，为了执行两次过滤操作就需要两个流，其次如果过滤操作复杂，两次的操作就会导致代码的冗余。</p>
<p>解决办法：收集器 partitioningBy，它接受一个流，并将其分为两部分。它使用 Predicate对象判断一个元素应该属于哪个部分，并根据boolean返回一个Map到列表。因此，对于true List中的元素，Predicate返回true，对于其他list中的元素，返回false。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Map</span><span class="o">&lt;</span><span class="n">Boolean</span><span class="p">,</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Artist</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">booleanListMap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">artList</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                                </span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">partitioningBy</span><span class="p">(</span><span class="n">artist</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">artist</span><span class="p">.</span><span class="na">getAge</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">13</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// 如果方法自带判断属性也可以直接用方法引用</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Boolean</span><span class="p">,</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Artist</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">booleanListMap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">artList</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                                </span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">partitioningBy</span><span class="p">(</span><span class="n">Artist</span><span class="p">::</span><span class="n">isSolo</span><span class="p">));</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="数据分组" class="headerLink">
    <a href="#%e6%95%b0%e6%8d%ae%e5%88%86%e7%bb%84" class="header-mark"></a>数据分组</h4><p>它是更自然的分割数据操作，与数据分块不同（将数据分成True、False两部分不同），它可以使用任意值对数据分组。groupingBy()</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="p">,</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Artist</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">collect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">artList</span><span class="p">.</span><span class="na">stream</span><span class="p">().</span><span class="na">collect</span><span class="p">(</span><span class="n">groupingBy</span><span class="p">(</span><span class="n">Artist</span><span class="p">::</span><span class="n">getAge</span><span class="p">));</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="字符串" class="headerLink">
    <a href="#%e5%ad%97%e7%ac%a6%e4%b8%b2" class="header-mark"></a>字符串</h4><p>最后生成一个字符串。</p>
<p>传统方式：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">StringBuilder</span><span class="w"> </span><span class="n">builder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StringBuilder</span><span class="p">(</span><span class="s">&#34;[&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">for</span><span class="p">(</span><span class="n">Artist</span><span class="w"> </span><span class="n">artist</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">artists</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">builder</span><span class="p">.</span><span class="na">length</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">1</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">builder</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">&#34;,&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">artist</span><span class="p">.</span><span class="na">getName</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">builder</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">name</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">builder</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">&#34;]&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">String</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">builder</span><span class="p">.</span><span class="na">toString</span><span class="p">();</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Stream方式：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">String</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">artists</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">Artist</span><span class="p">::</span><span class="n">getName</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">joining</span><span class="p">(</span><span class="s">&#34;,&#34;</span><span class="p">,</span><span class="s">&#34;[&#34;</span><span class="p">,</span><span class="s">&#34;]&#34;</span><span class="p">));</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="组合收集器" class="headerLink">
    <a href="#%e7%bb%84%e5%90%88%e6%94%b6%e9%9b%86%e5%99%a8" class="header-mark"></a>组合收集器</h4><p>在数据分组上进行改进，不需要返回两个对象的列表，而是返回对象中的某个属性。</p>
<p>比如，计算一个艺术家的专辑数量：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Artist</span><span class="p">,</span><span class="w"> </span><span class="n">Long</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">numberOfAlbums</span><span class="p">(</span><span class="n">Stream</span><span class="o">&lt;</span><span class="n">Album</span><span class="o">&gt;</span><span class="w"> </span><span class="n">albums</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">albums</span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">groupingBy</span><span class="p">(</span><span class="n">album</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">album</span><span class="p">.</span><span class="na">getMainMusician</span><span class="p">(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                         </span><span class="n">counting</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>重点是另一个收集器，counting，使用它就可以对专辑记数了。</p>
<p>比如，这次不想得到一组专辑，而是要得到专辑名：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Artist</span><span class="p">,</span><span class="w"> </span><span class="n">Long</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">numberOfAlbums</span><span class="p">(</span><span class="n">Stream</span><span class="o">&lt;</span><span class="n">Album</span><span class="o">&gt;</span><span class="w"> </span><span class="n">albums</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">albums</span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">groupingBy</span><span class="p">(</span><span class="n">Album</span><span class="p">::</span><span class="n">getMainMusician</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                        </span><span class="n">mapping</span><span class="p">(</span><span class="n">Album</span><span class="p">::</span><span class="n">getName</span><span class="p">,</span><span class="w"> </span><span class="n">toList</span><span class="p">())));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>mapping收集器和map方法一样，接受一个Function对象作为参数。它允许在收集器的容器上执行类似map操作，但是需要致命使用什么样的集合类存储结果。</p>
<p>不管是mapping还是joining都叫做下游收集器。收集器是生成最终结果的一剂配方，下游收集器则是生成部分结果的配方，主收集器中会用到下游收集器。</p>
<h4 id="重构和定制收集器" class="headerLink">
    <a href="#%e9%87%8d%e6%9e%84%e5%92%8c%e5%ae%9a%e5%88%b6%e6%94%b6%e9%9b%86%e5%99%a8" class="header-mark"></a>重构和定制收集器</h4><p>传统连接字符串</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">StringBuilder</span><span class="w"> </span><span class="n">builder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StringBuilder</span><span class="p">(</span><span class="s">&#34;[&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">for</span><span class="p">(</span><span class="n">Artist</span><span class="w"> </span><span class="n">artist</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">artists</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="k">if</span><span class="p">(</span><span class="n">builder</span><span class="p">.</span><span class="na">length</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">1</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="n">builder</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">&#34;,&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="n">builder</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">artist</span><span class="p">.</span><span class="na">getName</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">String</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">builder</span><span class="p">.</span><span class="na">toString</span><span class="p">();</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>map操作：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">StringBuilder</span><span class="w"> </span><span class="n">builder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StringBuilder</span><span class="p">(</span><span class="s">&#34;[&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">artists</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">Artist</span><span class="p">::</span><span class="n">getName</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="p">.</span><span class="na">forEach</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">           </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">builder</span><span class="p">.</span><span class="na">length</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">1</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">               </span><span class="n">builder</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">&#34;,&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">builder</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">&#34;]&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">String</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">builder</span><span class="p">.</span><span class="na">toString</span><span class="p">();</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>感觉和传统方式没有什么优势，同样都需要大量的代码，可读性依旧不高。</p>
<p>使用reduce操作：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">StringBuilder</span><span class="w"> </span><span class="n">reduce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">artists</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">Artist</span><span class="p">::</span><span class="n">getName</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="p">.</span><span class="na">reduce</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">StringBuilder</span><span class="p">(),</span><span class="w"> </span><span class="p">(</span><span class="n">builder</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">           </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">builder</span><span class="p">.</span><span class="na">length</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">1</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">               </span><span class="n">builder</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">&#34;,&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">           </span><span class="n">builder</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">name</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">           </span><span class="k">return</span><span class="w"> </span><span class="n">builder</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="p">},</span><span class="w"> </span><span class="p">(</span><span class="n">left</span><span class="p">,</span><span class="w"> </span><span class="n">right</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">left</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">right</span><span class="p">));</span><span class="w"> </span><span class="c1">// 这一步也可以写成 , StringBuilder::append</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">reduce</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">&#34;]&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">String</span><span class="w"> </span><span class="n">srt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reduce</span><span class="p">.</span><span class="na">toString</span><span class="p">();</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>这么一看，更复杂，可读性更差。</p>
<p>重构：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="w"> </span><span class="c1">// 自定义类</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">StringCombiner</span><span class="w"> </span><span class="n">combined</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">artists</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">Artist</span><span class="p">::</span><span class="n">getName</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="p">.</span><span class="na">reduce</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">StringCombiner</span><span class="p">(</span><span class="s">&#34;,&#34;</span><span class="p">,</span><span class="s">&#34;[&#34;</span><span class="p">,</span><span class="s">&#34;]&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">               </span><span class="n">StringCombiner</span><span class="p">::</span><span class="n">add</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">               </span><span class="n">StringCombiner</span><span class="p">::</span><span class="n">merge</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">String</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">combined</span><span class="p">.</span><span class="na">toString</span><span class="p">();</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>看着代码简洁了很多，但是背后的工作是一样的，只不过是将之前繁多的步骤，封装在一个StringCombiner类中。</p>
<p>StringCombiner.add()方法</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="n">StringCombiner</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">element</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="c1">// 如果是在初始位置，则添加前缀</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="k">if</span><span class="p">(</span><span class="n">areStart</span><span class="p">()){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">             </span><span class="n">builder</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">prefix</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="c1">// 否则添加 界定符（delimit）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="p">}</span><span class="k">else</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">             </span><span class="n">builder</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">delim</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="c1">// 正常添加元素</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="n">builder</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">element</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>add方法内其实调用的是一个StringBuilder对象。</p>
<p>StringCombiner.merge()方法</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="n">StringCombiner</span><span class="w"> </span><span class="nf">merge</span><span class="p">(</span><span class="n">StringCombiner</span><span class="w"> </span><span class="n">other</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="n">builder</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">other</span><span class="p">.</span><span class="na">builder</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>在重构部分，将reduce操作重构为一个收集器，其实还是有些冗余。既然怎么都要创建一个自定义类，为什么不直接创建一个收集器就叫StringCollector。</p>
<p>重构2：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">String</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">artists</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                     </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">Artist</span><span class="p">::</span><span class="n">getName</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                     </span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">StringCollector</span><span class="p">(</span><span class="s">&#34;,&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;[&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;]&#34;</span><span class="p">));</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>将所有的对字符串的操作代理交给了定制的收集器StringCollector，应用程序就不需要再关注其内部任何细节。它和框架中其他的Collector对象用起来应该都是一样的。</p>
<p>要实现Collector接口，由于Collector接口支持泛型，因此先得确定一些具体的类型：</p>
<ul>
<li>待收集元素的类型，这里是String；</li>
<li>累加器得类型StringCombiner；</li>
<li>最终结果的类型，依然是String；</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">StringCollector</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Collector</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">StringCombiner</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="p">{}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>一个收集器由四部分组成，首先是 Supplier，这是一个方法工厂，用来创建容器。在本地例中就是 StringCombiner。和reduce操作中第一个参数类似，它是后续操作的初值，也是格式。</p>
<p>实现了Collector接口就要重写几个方法：supplier、accumulator、combiner、finisher、characteristics。</p>
<p>Supplier是创建容器的工厂</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="n">Supplier</span><span class="o">&lt;</span><span class="n">StringCombiner</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">supplier</span><span class="p">(){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StringCombiner</span><span class="p">(</span><span class="n">delim</span><span class="p">,</span><span class="w"> </span><span class="n">prefix</span><span class="p">,</span><span class="w"> </span><span class="n">suffix</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>accumulator是结合之前操作的结果和当前值，生成新的值</strong>，它的作用和重构中reduce操作的第二个参数一样。</p>
<p>这里accumulator用来将流中的值叠加入容器中：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="n">BiConsumer</span><span class="o">&lt;</span><span class="n">StringCombiner</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">accumulator</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">StringCombiner</span><span class="p">::</span><span class="n">add</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>其中，BiConsumer&lt;T, U&gt;表示接受两个参数并不返回结果的操作。</p>
<p><strong>combiner就是合并操作</strong>，等同于reduce的第三个操作，也就是merge：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="n">BinaryOperator</span><span class="o">&lt;</span><span class="n">StringCombiner</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">combiner</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">StringCombiner</span><span class="p">::</span><span class="n">merge</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>其中，BinaryOperator&lt;T&gt; 表示根据两个同类型的数据进行运算/操作，产生一个和他们同行类型的结果。BinaryOperator是BiFuntion的特殊化。</p>
<p><strong>finisher操作</strong>就是将操作类型转换成成特定类型并返回：本操作最后返回的是字符串</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="n">Function</span><span class="o">&lt;</span><span class="n">StringCombiner</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">finisher</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">StringCombiner</span><span class="p">::</span><span class="n">toString</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>其中 Function&lt;T, R&gt;表示接受一个参数T，返回一个结果R。</p>
<p>还有一个收集器Collector的重写方法，characteristics，它表示特征，它是一组描述收集器的对象。</p>
<p>上面的StringCominer的功能已经在在java.until.StringJoiner类中实现。</p>
<h4 id="对收集器的归一化处理" class="headerLink">
    <a href="#%e5%af%b9%e6%94%b6%e9%9b%86%e5%99%a8%e7%9a%84%e5%bd%92%e4%b8%80%e5%8c%96%e5%a4%84%e7%90%86" class="header-mark"></a>对收集器的归一化处理</h4><p>Collectors.reducing()为流上的归一操作提供了统一实现。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">String</span><span class="w"> </span><span class="n">resut</span><span class="w"> </span><span class="o">=</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">artists</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">Artist</span><span class="p">::</span><span class="n">getName</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">reducing</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="k">new</span><span class="w"> </span><span class="n">StringCombiner</span><span class="p">(</span><span class="s">&#34;,&#34;</span><span class="p">,</span><span class="s">&#34;[&#34;</span><span class="p">,</span><span class="s">&#34;]&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="n">name</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StringCombiner</span><span class="p">(</span><span class="s">&#34;,&#34;</span><span class="p">,</span><span class="s">&#34;[&#34;</span><span class="p">,</span><span class="s">&#34;]&#34;</span><span class="p">).</span><span class="na">add</span><span class="p">(</span><span class="n">name</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="n">StringCombiner</span><span class="p">::</span><span class="n">merge</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">toString</span><span class="p">();</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>或者通过两个map达到一样的效果</p>
<p>它是将reducing中的第二步操作放到了map中</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">String</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">artists</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">Artist</span><span class="p">::</span><span class="n">getName</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StringCombiner</span><span class="p">(</span><span class="s">&#34;,&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;[&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;]&#34;</span><span class="p">).</span><span class="na">add</span><span class="p">(</span><span class="n">name</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">reduce</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">StringCombiner</span><span class="p">(</span><span class="s">&#34;,&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;[&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;]&#34;</span><span class="p">),</span><span class="w"> </span><span class="n">StringCombiner</span><span class="p">::</span><span class="n">merge</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">toString</span><span class="p">();</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>对比，groupingBy 和 groupingByConcurrent，前面的是非并发的线程不安全的，后面是并发的同样线程不安全。</p>
<h4 id="map迭代方式" class="headerLink">
    <a href="#map%e8%bf%ad%e4%bb%a3%e6%96%b9%e5%bc%8f" class="header-mark"></a>Map迭代方式</h4><p>传统方式：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Map</span><span class="o">&lt;</span><span class="n">Artist</span><span class="p">,</span><span class="w"> </span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">countOfAlbums</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">for</span><span class="p">(</span><span class="n">Map</span><span class="p">.</span><span class="na">ENtry</span><span class="o">&lt;</span><span class="n">Artist</span><span class="p">,</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Album</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">entry</span><span class="p">:</span><span class="w"> </span><span class="n">albumsByArtist</span><span class="p">.</span><span class="na">entrySet</span><span class="p">()){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Artist</span><span class="w"> </span><span class="n">artist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">entry</span><span class="p">.</span><span class="na">getKey</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Album</span><span class="o">&gt;</span><span class="w"> </span><span class="n">albums</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">entry</span><span class="p">.</span><span class="na">getValue</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">countOfAlbums</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">artist</span><span class="p">,</span><span class="w"> </span><span class="n">albums</span><span class="p">.</span><span class="na">size</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>内部迭代器：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Map</span><span class="o">&lt;</span><span class="n">Artist</span><span class="p">,</span><span class="w"> </span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">countOfAlbums</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">albumsByArtists</span><span class="p">.</span><span class="na">forEach</span><span class="p">((</span><span class="n">artist</span><span class="p">,</span><span class="w"> </span><span class="n">albums</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">countOfAlbums</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">artist</span><span class="p">,</span><span class="w"> </span><span class="n">albums</span><span class="p">.</span><span class="na">size</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">});</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="补充" class="headerLink">
    <a href="#%e8%a1%a5%e5%85%85" class="header-mark"></a>补充</h3><h4 id="boxed" class="headerLink">
    <a href="#boxed" class="header-mark"></a>boxed()</h4><p>IntSream是int类型的流，Stream&lt;Integer&gt; 是Integer类型的流；而 boxed()值得就是对基本类型的装箱。</p>
<h4 id="maptoint" class="headerLink">
    <a href="#maptoint" class="header-mark"></a>mapToInt()</h4><p>就是将参数转成IntStream。然后接着 .toArray()就是转成数组。</p>
<h2 id="数据并行化" class="headerLink">
    <a href="#%e6%95%b0%e6%8d%ae%e5%b9%b6%e8%a1%8c%e5%8c%96" class="header-mark"></a>数据并行化</h2><p>赘述为什么需要并行化和什么时候会带来性能的提升</p>
<h3 id="并行和并发" class="headerLink">
    <a href="#%e5%b9%b6%e8%a1%8c%e5%92%8c%e5%b9%b6%e5%8f%91" class="header-mark"></a>并行和并发</h3><p>并发：一个时间段内处理两个任务，他们之间还是有先后顺序（单核）。</p>
<p>并行：两个任务同时执行（多核cpu）。并行化，是指为缩短任务执行时间，将一个任务分解成几部分，然后并行执行。举例，很多马来拉车，省时省力。相应地，cpu承载的工作量比顺序执行要大。</p>
<p><strong>数据并行化</strong>，将数据分成块，每块数据分配单独的处理单元。举例，原来一个马车拉的货，现在分给另一个马车，一边拉一半。</p>
<p>在处理大量数据上，数据并行化管用。</p>
<h3 id="并行化的重要性" class="headerLink">
    <a href="#%e5%b9%b6%e8%a1%8c%e5%8c%96%e7%9a%84%e9%87%8d%e8%a6%81%e6%80%a7" class="header-mark"></a>并行化的重要性</h3><p>以前计算能力依赖单核cpu的时钟频率的提升，比如5mhz到60mhz。现在单核cpu的时钟频率提升不大，大家都转向了多核处理器，因此，想提升计算能力，就要将任务分解交个各个核同时处理，拆分的越多分配的核数越多，处理时间越迅速。</p>
<h3 id="并行化流操作" class="headerLink">
    <a href="#%e5%b9%b6%e8%a1%8c%e5%8c%96%e6%b5%81%e6%93%8d%e4%bd%9c" class="header-mark"></a>并行化流操作</h3><p>并行化操作流只需要改变一个方法调用，将 .stream()替换成 .parallelStream()。</p>
<p>思考，并行化运行基于流的代码是否比串行化运行更快？影响因素有很多，比如输入流的大小，假设样本数量为10，那么串行肯定优于并行；样本数量10k，二者速度可能相仿；样本数量千万级或者远远更大，此时，并行优于串行。</p>
<h3 id="模拟系统" class="headerLink">
    <a href="#%e6%a8%a1%e6%8b%9f%e7%b3%bb%e7%bb%9f" class="header-mark"></a>模拟系统</h3><p>搭建一个简易的模拟系统来理解摇色子，蒙特卡洛模拟法，它会重复相同的模拟很多次，每次都随机生成种子，结果被记录下来。汇总得到一个对系统的全面模拟。</p>
<h3 id="限制" class="headerLink">
    <a href="#%e9%99%90%e5%88%b6" class="header-mark"></a>限制</h3><p>流框架会自己处理同步操作，所以要避免给数据结构加锁，否则可能会自找麻烦。</p>
<p>除了parallel方法还有一个叫sequential的方法，它们分别是串行和并行。如果同时调用两个方法，最后调用的有用。</p>
<h3 id="性能" class="headerLink">
    <a href="#%e6%80%a7%e8%83%bd" class="header-mark"></a>性能</h3><p>影响性能的因素：</p>
<ul>
<li>数据大小，数据足够大，并行处理才有意义。</li>
<li>源数据结构，通常是集合。</li>
<li>装箱，处理基本类比装箱快。</li>
<li>核的数量，核数越多，潜在性能提升越大。</li>
<li>单元处理开销，花在流中每个元素身上的时间越长，并行操作带来的性能提升越明显。（就是单个元素越复杂，并行效果越好）。</li>
</ul>
<p>在底层，并行流还是沿用了 fork/join框架，fork递归式分解问题，然后每段并行执行，最终由join合并结果。</p>
<p>将数据结构分类：</p>
<ul>
<li>性能好：ArrayList、数组、IntStream.range，这些数据结构支持随机读取，可以很轻易地被任意分解。</li>
<li>性能一般：HashSer、TreeSet，不易公平地被分解，大多数分解是可能的。</li>
<li>性能差，LinkedList、Streams.iterate、BufferedReader.lines，可能要花费O(N)甚至更高的时间复杂度来分解问题，很难分解。</li>
</ul>
<p>初始数据结构影响巨大，样本数量足够大的时候，ArrayList比LinkedList快10倍。</p>
<h3 id="并行化数组操作" class="headerLink">
    <a href="#%e5%b9%b6%e8%a1%8c%e5%8c%96%e6%95%b0%e7%bb%84%e6%93%8d%e4%bd%9c" class="header-mark"></a>并行化数组操作</h3><p>对数组的操作都在工具类Arrays中，</p>
<p>parallelSetAll，更新数组元素：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kt">double</span><span class="o">[]</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">doulbe</span><span class="o">[</span><span class="n">size</span><span class="o">]</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Arrays</span><span class="p">.</span><span class="na">parallelSetAll</span><span class="p">(</span><span class="n">values</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">i</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>parallelPrefix，对时间序列数据做累加</p>
<p>计算简单滑动平均数</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kt">double</span><span class="o">[]</span><span class="w"> </span><span class="n">sums</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Arrays</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">values</span><span class="p">,</span><span class="w"> </span><span class="n">values</span><span class="p">.</span><span class="na">length</span><span class="p">);</span><span class="w"> </span><span class="c1">// 复制一份输入数据</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Arrays</span><span class="p">.</span><span class="na">parallelPrefix</span><span class="p">(</span><span class="n">sums</span><span class="p">,</span><span class="w"> </span><span class="n">Double</span><span class="p">::</span><span class="n">sum</span><span class="p">);</span><span class="w"> </span><span class="c1">// 将数组元素相加，用sums保留求和结果。比如输入0，1，2，3，4，3.5，计算后的值为 0.0，1.0，3.0，6.0，10.0，13.5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kt">int</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">return</span><span class="w"> </span><span class="n">IntStream</span><span class="p">.</span><span class="na">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="w"> </span><span class="n">sums</span><span class="p">.</span><span class="na">length</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">mapToDouble</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="kt">double</span><span class="w"> </span><span class="n">prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">0</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">sums</span><span class="o">[</span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">n</span><span class="o">]</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">sums</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">prefix</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="c1">// 使用总和减去窗口起始值，然后再除以n得到平均值</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">})</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">toArray</span><span class="p">();</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="测试调试重构" class="headerLink">
    <a href="#%e6%b5%8b%e8%af%95%e8%b0%83%e8%af%95%e9%87%8d%e6%9e%84" class="header-mark"></a>测试、调试、重构</h2><h3 id="重构候选项" class="headerLink">
    <a href="#%e9%87%8d%e6%9e%84%e5%80%99%e9%80%89%e9%a1%b9" class="header-mark"></a>重构候选项</h3><h4 id="进进出出摇摇晃晃" class="headerLink">
    <a href="#%e8%bf%9b%e8%bf%9b%e5%87%ba%e5%87%ba%e6%91%87%e6%91%87%e6%99%83%e6%99%83" class="header-mark"></a>进进出出、摇摇晃晃</h4><p>在记录日志时，isDebugEnabled()用来检查是否启用调试级别。仔细想想，一段代码不断地查询和操作对象目的就只是为了给该对象设个值。那么在检查状态这部分不应该是个内部状态么，一查询就暴露了。</p>
<p>传统debug</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Logger</span><span class="w"> </span><span class="n">logger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Logger</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">if</span><span class="p">(</span><span class="n">logger</span><span class="p">.</span><span class="na">isDebugEnabled</span><span class="p">()){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">logger</span><span class="p">.</span><span class="na">debug</span><span class="p">(</span><span class="s">&#34;Look at this: &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">exoensiveOperation</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>lambda debug</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Logger</span><span class="w"> </span><span class="n">logger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Logger</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">logger</span><span class="p">.</span><span class="na">debug</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s">&#34;Look at this: &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">expensiveOperation</span><span class="p">());</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Lambda表达式更好地面向对象编程（OOP），面向对象编程的核心之一就是封装局部状态，比如日志的级别。</p>
<p>传统方式做的不好，isDebugEnabled方法暴露了内部封装。使用Lambda表达式，外面的代码根本不需要检查日志级别。</p>
<h4 id="孤独的覆盖" class="headerLink">
    <a href="#%e5%ad%a4%e7%8b%ac%e7%9a%84%e8%a6%86%e7%9b%96" class="header-mark"></a>孤独的覆盖</h4><p>假设在数据库中查找艺术家，每个线程只做一次这种查询：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">ThreadLocal</span><span class="o">&lt;</span><span class="n">Album</span><span class="o">&gt;</span><span class="w"> </span><span class="n">thisAlbum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ThreadLocal</span><span class="o">&lt;</span><span class="n">Album</span><span class="o">&gt;</span><span class="p">(){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nd">@Override</span><span class="w"> </span><span class="kd">protected</span><span class="w"> </span><span class="n">Album</span><span class="w"> </span><span class="nf">initialValue</span><span class="p">(){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">database</span><span class="p">.</span><span class="na">lookupCurrentAlbum</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">};</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>这段代码异味是使用继承，其目的只是为了覆盖一个方法。ThreadLocal能创建一个工厂，为每个线程最多产生一个值。确保非线程安全的类在并发环境下安全使用的一种简单方式。</p>
<p>Java8中，可以为工厂方法withInitial传入一个Supplier对象的实例来创建对象：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">ThreadLocal</span><span class="o">&lt;</span><span class="n">Alubm</span><span class="o">&gt;</span><span class="w"> </span><span class="n">thisAlbum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ThreadLocal</span><span class="p">.</span><span class="na">withInitial</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">database</span><span class="p">.</span><span class="na">lookupCurrentAlbum</span><span class="p">());</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>此代码优于前者是因为：</p>
<ol>
<li>任何已有Supplier&lt;Album&gt;实例不需要重新封装，就可以在此使用，这鼓励了重用和组合。</li>
<li>代码简短，不用花时间在继承的样本代码上。</li>
<li>JVM会稍加在一个类。</li>
</ol>
<h4 id="同样的东西写两遍" class="headerLink">
    <a href="#%e5%90%8c%e6%a0%b7%e7%9a%84%e4%b8%9c%e8%a5%bf%e5%86%99%e4%b8%a4%e9%81%8d" class="header-mark"></a>同样的东西写两遍</h4><p>Don&rsquo;t Repeat YourSelf, DRY模式。还有其反面 Write Everything Twice, WET模式。后者代码异味多见于重复的样本代码，难于重构。</p>
<p>什么时候该将WET代码Lambda化？如果有一个整体上大概相似的模式，只是行为上有所不同，就可以试着加入一个Lambda表达式。</p>
<p>Order类的命令式实现</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="nf">countRunningTIme</span><span class="p">(){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kt">long</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">0</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="n">Album</span><span class="w"> </span><span class="n">album</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">albums</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">for</span><span class="p">(</span><span class="n">Track</span><span class="w"> </span><span class="n">track</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">tracks</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="n">count</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">track</span><span class="p">.</span><span class="na">getLength</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">count</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="nf">countMusicians</span><span class="p">(){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kt">long</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">0</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="n">Album</span><span class="w"> </span><span class="n">album</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">albums</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">count</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">album</span><span class="p">.</span><span class="na">getMusicianList</span><span class="p">().</span><span class="na">size</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">count</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="nf">countTracks</span><span class="p">(){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kt">long</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">0</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="n">Album</span><span class="w"> </span><span class="n">album</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">albums</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">count</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">album</span><span class="p">.</span><span class="na">getTrackList</span><span class="p">().</span><span class="na">size</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">count</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>三个方法，里面的的代码基本一样。</p>
<p>流重写</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="nf">countRunningTimg</span><span class="p">(){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">albums</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">mapToLong</span><span class="p">(</span><span class="n">album</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">album</span><span class="p">.</span><span class="na">getTracks</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                        </span><span class="p">.</span><span class="na">mapToLong</span><span class="p">(</span><span class="n">track</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">track</span><span class="p">.</span><span class="na">getLength</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                        </span><span class="p">.</span><span class="na">sum</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">sum</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="nf">countMusicians</span><span class="p">(){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">albums</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">mapToLong</span><span class="p">(</span><span class="n">album</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">album</span><span class="p">.</span><span class="na">getMusicians</span><span class="p">().</span><span class="na">count</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">sum</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="nf">countTracks</span><span class="p">(){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">albums</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">mapToLong</span><span class="p">(</span><span class="n">album</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">album</span><span class="p">.</span><span class="na">getTracks</span><span class="p">().</span><span class="na">count</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">sum</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>这段代码仍然有重用性问题。可以实现一个函数，返回long，统计所有专辑的某些特性，还需要一个lambda表达式，告诉统计专辑上的信息。java8核心类库提供这样一个类型 ToLongFunction&lt;&gt;。</p>
<p>将专辑转换成流，将专辑映射为long，然后求和。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="nf">countFeature</span><span class="p">(</span><span class="n">ToLongFunction</span><span class="o">&lt;</span><span class="n">Album</span><span class="o">&gt;</span><span class="w"> </span><span class="n">function</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">albums</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">mapToLong</span><span class="p">(</span><span class="n">function</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">sum</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="nf">countTracks</span><span class="p">(){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">countFeature</span><span class="p">(</span><span class="n">album</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">album</span><span class="p">.</span><span class="na">getTracks</span><span class="p">().</span><span class="na">count</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="nf">countRunningTime</span><span class="p">(){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">countFeature</span><span class="p">(</span><span class="n">album</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">album</span><span class="p">.</span><span class="na">getTracks</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                        </span><span class="p">.</span><span class="na">mapToLong</span><span class="p">(</span><span class="n">track</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">track</span><span class="p">.</span><span class="na">getLength</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                        </span><span class="p">.</span><span class="na">sum</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="nf">countMusicians</span><span class="p">(){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">countFeature</span><span class="p">(</span><span class="n">album</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">album</span><span class="p">.</span><span class="na">getMusicians</span><span class="p">().</span><span class="na">count</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="日志和打印消息" class="headerLink">
    <a href="#%e6%97%a5%e5%bf%97%e5%92%8c%e6%89%93%e5%8d%b0%e6%b6%88%e6%81%af" class="header-mark"></a>日志和打印消息</h3><p>之前我们在流中想打印是在 foreach(a -&gt; System.out.println(&ldquo;例如：&rdquo; + a));</p>
<p>这样操作的缺点是，当调试代码时，比如debug，由于流只能使用一次，在某一段打断点，如果还想继续就必须重新创建流。这个就是惰性求值。</p>
<p>解决方案：peek</p>
<p>流中有一个方法peek()可以查看每一个值，同时可以继续操作流。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">nationalities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">album</span><span class="p">.</span><span class="na">getMusicians</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="p">.</span><span class="na">filter</span><span class="p">(</span><span class="n">artist</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">artist</span><span class="p">.</span><span class="na">getName</span><span class="p">().</span><span class="na">startsWith</span><span class="p">(</span><span class="s">&#34;The&#34;</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">artist</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">artist</span><span class="p">.</span><span class="na">getNationality</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="p">.</span><span class="na">peek</span><span class="p">(</span><span class="n">nation</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">,</span><span class="n">println</span><span class="p">(</span><span class="s">&#34;例如：&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">nation</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="n">toSet</span><span class="p">());</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>记录日志是peek的用途之一，可以设置断点。</p>
<h2 id="设计和架构的原则" class="headerLink">
    <a href="#%e8%ae%be%e8%ae%a1%e5%92%8c%e6%9e%b6%e6%9e%84%e7%9a%84%e5%8e%9f%e5%88%99" class="header-mark"></a>设计和架构的原则</h2><p>探索如何使用Lambda表达式实现SOLID原则。</p>
<h3 id="lambda表达式改变了设计模式" class="headerLink">
    <a href="#lambda%e8%a1%a8%e8%be%be%e5%bc%8f%e6%94%b9%e5%8f%98%e4%ba%86%e8%ae%be%e8%ae%a1%e6%a8%a1%e5%bc%8f" class="header-mark"></a>Lambda表达式改变了设计模式</h3><p>单例模式确保只生产一个对象实例，然而它却让程序变得更脆弱，难于测试。敏捷开发的流行，让测试变得更加重要，因此单例模式变成了反模式，一种要避免的模式。</p>
<p>本章主要讨论如何使用Lambda让设计模式变得更好。</p>
<h4 id="命令者模式" class="headerLink">
    <a href="#%e5%91%bd%e4%bb%a4%e8%80%85%e6%a8%a1%e5%bc%8f" class="header-mark"></a>命令者模式</h4><p>命令者是一个对象，它封装了调用另一个方法的所有细节。</p>
<p>客户端 -创建- 发起者，发起者 -调用- 命令者，客户端 -使用- 具体命令者，具体命令者 -实现- 命令者，具体命令者 -调用- 命令接受者。</p>
<ul>
<li>命令者：封装了所有调用命令执行者的信息。</li>
<li>发起者：控制一个或多个命令的顺序和执行。</li>
<li>客户端：创建具体的命令者实例。</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">Editor</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">save</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">open</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">close</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">Action</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">perform</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Save</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Action</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Editor</span><span class="w"> </span><span class="n">editor</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="nf">Save</span><span class="p">(</span><span class="n">Editor</span><span class="w"> </span><span class="n">editor</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">this</span><span class="p">.</span><span class="na">editor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">editor</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">perform</span><span class="p">(){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">editor</span><span class="p">.</span><span class="na">save</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Open</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Action</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Editor</span><span class="w"> </span><span class="n">editor</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="nf">Open</span><span class="p">(</span><span class="n">Editor</span><span class="w"> </span><span class="n">editor</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">this</span><span class="p">.</span><span class="na">editor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">editor</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">perform</span><span class="p">(){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">editor</span><span class="p">.</span><span class="na">open</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Macro</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Action</span><span class="o">&gt;</span><span class="w"> </span><span class="n">actions</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="nf">Macro</span><span class="p">(){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">actions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">record</span><span class="p">(</span><span class="n">Action</span><span class="w"> </span><span class="n">action</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">actions</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">action</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">(){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">actions</span><span class="p">.</span><span class="na">forEach</span><span class="p">(</span><span class="n">Action</span><span class="p">::</span><span class="n">perform</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>不同方式的调用</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Macro</span><span class="w"> </span><span class="n">macro</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Macro</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">macro</span><span class="p">.</span><span class="na">record</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Open</span><span class="p">(</span><span class="n">editor</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">macro</span><span class="p">.</span><span class="na">record</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">editor</span><span class="p">.</span><span class="na">open</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">macro</span><span class="p">.</span><span class="na">record</span><span class="p">(</span><span class="n">editor</span><span class="p">::</span><span class="n">open</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">...</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="策略模式" class="headerLink">
    <a href="#%e7%ad%96%e7%95%a5%e6%a8%a1%e5%bc%8f" class="header-mark"></a>策略模式</h4><p>策略模式能在运行时改变软件的算法行为。一个问题可以由多种算法实现，将它们封装在一个统一的接口背后，选择哪个算法就是策略模式决定的。</p>
<p>文件压缩就是一个例子，它提供各种压缩方式，比如 zip、gzip等。</p>
<p>整体流程就是：</p>
<p>压缩器 调用 压缩策略，具体的压缩算法实现压缩策略。</p>
<p>定义压缩数据的策略借口</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">CompressionStrategy</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="n">OutputStream</span><span class="w"> </span><span class="nf">compress</span><span class="p">(</span><span class="n">OutputStream</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>两个类实现该接口，zip和gzip。</p>
<p>使用gzip算法压缩数据</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">GzipCompressionStrategy</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">CompressionStrategy</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="n">OutpuStream</span><span class="w"> </span><span class="nf">compress</span><span class="p">(</span><span class="n">OutputStream</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">GZIPOutputStream</span><span class="p">(</span><span class="n">data</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>使用zip算法压缩数据</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ZipCompressionStrategy</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">CompressionStrategy</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="n">OutpuStream</span><span class="w"> </span><span class="nf">compress</span><span class="p">(</span><span class="n">OutputStream</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ZIPOutputStream</span><span class="p">(</span><span class="n">data</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>实现Compressor类，这就是使用策略模式的地方。它有一个compress方法，读入文件，压缩后输出。它的构造函数有一个CompressionStrategy参数，调用代码后可以在运行期使用该参数决定使用哪种压缩策略，比如，可以等待用户输入选择。</p>
<p>在构造类时提供压缩策略</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Compressor</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">CompressionStrategy</span><span class="w"> </span><span class="n">strategy</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="nf">Compressor</span><span class="p">(</span><span class="n">CompressionStrategy</span><span class="w"> </span><span class="n">strategy</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">this</span><span class="p">.</span><span class="na">strategy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strategy</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">compress</span><span class="p">(</span><span class="n">Path</span><span class="w"> </span><span class="n">inFile</span><span class="p">,</span><span class="w"> </span><span class="n">File</span><span class="w"> </span><span class="n">outFile</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">try</span><span class="p">(</span><span class="n">OutputStream</span><span class="w"> </span><span class="n">outStream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FileOutputStream</span><span class="p">(</span><span class="n">outFile</span><span class="p">)){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="n">Files</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span><span class="n">inFile</span><span class="p">,</span><span class="w"> </span><span class="n">strategy</span><span class="p">.</span><span class="na">compress</span><span class="p">(</span><span class="n">outStream</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>通过这种方式，只需要new一个Compressor就可以使用我们想要的策略。</p>
<p>使用具体策略类初始化Compressor</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Compressor</span><span class="w"> </span><span class="n">gzipCom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Compressor</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">GzipCompressionStrategy</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">gzipCom</span><span class="p">.</span><span class="na">compress</span><span class="p">(</span><span class="n">inFile</span><span class="p">,</span><span class="w"> </span><span class="n">outFile</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Compressor</span><span class="w"> </span><span class="n">zipCom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Compressor</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">ZipCompressionStrategy</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">zipCom</span><span class="p">.</span><span class="na">compress</span><span class="p">(</span><span class="n">inFile</span><span class="p">,</span><span class="w"> </span><span class="n">outFile</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Lambda表达式或者方法引用去掉样本代码</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Compressor</span><span class="w"> </span><span class="n">gzipCom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Compressor</span><span class="p">(</span><span class="n">GzipCompressionStrategy</span><span class="p">::</span><span class="k">new</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">gzipCom</span><span class="p">.</span><span class="na">compress</span><span class="p">(</span><span class="n">inFile</span><span class="p">,</span><span class="w"> </span><span class="n">outFile</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Compressor</span><span class="w"> </span><span class="n">zipCom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Compressor</span><span class="p">(</span><span class="n">ZipCompressionStrategy</span><span class="p">::</span><span class="k">new</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">zipCom</span><span class="p">.</span><span class="na">compress</span><span class="p">(</span><span class="n">inFile</span><span class="p">,</span><span class="w"> </span><span class="n">outFile</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="观察者模式" class="headerLink">
    <a href="#%e8%a7%82%e5%af%9f%e8%80%85%e6%a8%a1%e5%bc%8f" class="header-mark"></a>观察者模式</h4><p>被观察者持有一个观察者列表，当被观察者的状态发生改变时，会通知观察者。这种模式被大量应用于基于MVC的GUI工具中，以此让模型状态发生变化时，自动刷新视图模块，达到二者解耦。</p>
<p>比如，观察的是月球，NASA和Aliens都对月球感兴趣。</p>
<p>观察登陆到月球组织的接口</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">LandingObserver</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">observeLanding</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Moon类</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Moon</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">LaningObserver</span><span class="o">&gt;</span><span class="w"> </span><span class="n">observers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArfrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">land</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">for</span><span class="p">(</span><span class="n">LandingObserver</span><span class="w"> </span><span class="n">observer</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">observers</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="n">observer</span><span class="p">.</span><span class="na">observeLanding</span><span class="p">(</span><span class="n">name</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">startSpying</span><span class="p">(</span><span class="n">LandingObserver</span><span class="w"> </span><span class="n">observer</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">observers</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">observer</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>外星人观察到人类登陆月球</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Aliens</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">LandingObserver</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">observeLanding</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="n">name</span><span class="p">.</span><span class="na">contains</span><span class="p">(</span><span class="s">&#34;Apollo&#34;</span><span class="p">)){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;They&#39;re distracted, lets invade earch!&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>NASA观察有人登陆月球</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Nasa</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">LandingObserver</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">observeLanding</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="n">name</span><span class="p">.</span><span class="na">contains</span><span class="p">(</span><span class="s">&#34;Apollo&#34;</span><span class="p">)){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;We made it&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>使用类的方式构建</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Moon</span><span class="w"> </span><span class="n">moon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Moon</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">moon</span><span class="p">.</span><span class="na">startSpying</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Nasa</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">moon</span><span class="p">.</span><span class="na">startSpying</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Aliens</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">moon</span><span class="p">.</span><span class="na">land</span><span class="p">(</span><span class="s">&#34;An asteroid&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">moon</span><span class="p">.</span><span class="na">land</span><span class="p">(</span><span class="s">&#34;Apollo 11&#34;</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Lambda方式构建</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Moon</span><span class="w"> </span><span class="n">moon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Moon</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">moon</span><span class="p">.</span><span class="na">startSpying</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">name</span><span class="p">.</span><span class="na">contains</span><span class="p">(</span><span class="s">&#34;Apollo&#34;</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;We made it&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">moon</span><span class="p">.</span><span class="na">startSpying</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">name</span><span class="p">.</span><span class="na">contains</span><span class="p">(</span><span class="s">&#34;Apollo&#34;</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;They&#39;re distracted, lets invade earth!&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">moon</span><span class="p">.</span><span class="na">land</span><span class="p">(</span><span class="s">&#34;An asteroid&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">moon</span><span class="p">.</span><span class="na">land</span><span class="p">(</span><span class="s">&#34;Apollo 11&#34;</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Lambda表达式的方式可以不用重写observeLanding里面的判断。</p>
<h2 id="new相关" class="headerLink">
    <a href="#new%e7%9b%b8%e5%85%b3" class="header-mark"></a>New相关</h2><p>创建一个List/Stream:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">List</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">1</span><span class="p">,</span><span class="n">2</span><span class="p">,</span><span class="n">3</span><span class="p">,</span><span class="n">4</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Stream</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">1</span><span class="p">,</span><span class="n">2</span><span class="p">,</span><span class="n">3</span><span class="p">,</span><span class="n">4</span><span class="p">,</span><span class="n">5</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div></div>

        


<h2>Related Content</h2>
<div class="related-container">
    <div class="related-item-container">
            <div class="related-image">
                <a href="/singleton-pattern/"><img
        
        loading="lazy"
        src="/posts/design-patterns/design-patterns_cover.png"
        srcset="/posts/design-patterns/design-patterns_cover.png, /posts/design-patterns/design-patterns_cover.png 1.5x, /posts/design-patterns/design-patterns_cover.png 2x"
        sizes="auto"
        alt="/posts/design-patterns/design-patterns_cover.png"
        title="/posts/design-patterns/design-patterns_cover.png" height="200"   width="400" ></a>
            </div><h2 class="related-title">
                <a href="/singleton-pattern/">Singleton Pattern for Java</a>
            </h2>
        </div>
    <div class="related-item-container">
            <div class="related-image">
                <a href="/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3jvm/"><img
        
        loading="lazy"
        src="/posts/java/jvm-notes/jvm_cover.jpg"
        srcset="/posts/java/jvm-notes/jvm_cover.jpg, /posts/java/jvm-notes/jvm_cover.jpg 1.5x, /posts/java/jvm-notes/jvm_cover.jpg 2x"
        sizes="auto"
        alt="/posts/java/jvm-notes/jvm_cover.jpg"
        title="/posts/java/jvm-notes/jvm_cover.jpg" height="200"   width="400" ></a>
            </div><h2 class="related-title">
                <a href="/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3jvm/">深入理解JVM</a>
            </h2>
        </div>
    

</div>

<div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2023-09-21</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"><span><a class="link-to-mardown" href=/java-stream%E6%93%8D%E4%BD%9C/index.md target="_blank" rel="noopener noreferrer">Read markdown</a>
                    </span></div>
            <div class="post-info-share"><button title="Share on Twitter" data-sharer="twitter" data-url="https://hongspell.site/java-stream%E6%93%8D%E4%BD%9C/" data-title="了解Java Stream流操作" data-via="ssdlaohu9527" data-hashtags="java,stream,lambda表达式"><span class="fab fa-twitter fa-fw"></span></button><button title="Share on Facebook" data-sharer="facebook" data-url="https://hongspell.site/java-stream%E6%93%8D%E4%BD%9C/" data-hashtag="java"><span class="fab fa-facebook-square fa-fw"></span></button><button title="Share on WhatsApp" data-sharer="whatsapp" data-url="https://hongspell.site/java-stream%E6%93%8D%E4%BD%9C/" data-title="了解Java Stream流操作" data-web><span class="fab fa-whatsapp fa-fw"></span></button><button title="Share on Line" data-sharer="line" data-url="https://hongspell.site/java-stream%E6%93%8D%E4%BD%9C/" data-title="了解Java Stream流操作"><span data-svg-src="/lib/simple-icons/icons/line.min.svg"></span></button><button title="Share on 微博" data-sharer="weibo" data-url="https://hongspell.site/java-stream%E6%93%8D%E4%BD%9C/" data-title="了解Java Stream流操作" data-image="/posts/java/java-stream/java_stream_cover.jpg"><span class="fab fa-weibo fa-fw"></span></button><button title="Share on Myspace" data-sharer="myspace" data-url="https://hongspell.site/java-stream%E6%93%8D%E4%BD%9C/" data-title="了解Java Stream流操作" data-description=""><span data-svg-src="/lib/simple-icons/icons/myspace.min.svg"></span></button><button title="Share on Blogger" data-sharer="blogger" data-url="https://hongspell.site/java-stream%E6%93%8D%E4%BD%9C/" data-title="了解Java Stream流操作" data-description=""><span class="fab fa-blogger fa-fw"></span></button><button title="Share on Evernote" data-sharer="evernote" data-url="https://hongspell.site/java-stream%E6%93%8D%E4%BD%9C/" data-title="了解Java Stream流操作"><span class="fab fa-evernote fa-fw"></span></button></div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/java/">java</a>,&nbsp;<a href="/tags/stream/">stream</a>,&nbsp;<a href="/tags/lambda%E8%A1%A8%E8%BE%BE%E5%BC%8F/">lambda表达式</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/singleton-pattern/" class="prev" rel="prev" title="Singleton Pattern for Java"><i class="fas fa-angle-left fa-fw"></i>Singleton Pattern for Java</a>
            <a href="/innodb-page/" class="next" rel="next" title="Innodb Page">Innodb Page<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
</article></div>
        </main><footer class="footer">
        <div class="footer-container"><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2023 - 2024</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank" rel="noopener noreferrer">Hong</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span><span class="icp-splitter">&nbsp;|&nbsp;</span><br class="icp-br"/>
                    <span class="icp"><a href="http://beian.miit.gov.cn/" target="_blank">黑ICP备2023016241号</a></span></div>
            <div class="footer-line"></div>
            <div class="footer-line">
            </div>
        </div></footer></div>

    <div id="fixed-buttons"><a href="#back-to-top" id="back-to-top-button" class="fixed-button" title="Back to Top">
            <i class="fas fa-arrow-up fa-fw"></i>
        </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
            <i class="fas fa-comment fa-fw"></i>
        </a>
    </div><div id="cookieconsent-container"></div><div class="assets"><link rel="stylesheet" href="/lib/lightgallery/lightgallery.min.css"><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/katex/copy-tex.min.css">
        <noscript><link rel="stylesheet" href="/lib/katex/copy-tex.min.css"></noscript><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":10},"comment":{},"cookieconsent":{"content":{"dismiss":"Got it!","link":"Learn more","message":"This website uses Cookies to improve your experience."},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"data":{"desktop-header-typeit":"HongSpell","mobile-header-typeit":"HongSpell"},"lightGallery":{"actualSize":false,"exThumbImage":"data-thumbnail","hideBarsDelay":2000,"selector":".lightgallery","speed":400,"thumbContHeight":80,"thumbWidth":80,"thumbnail":true},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"distance":100,"findAllMatches":false,"fuseIndexURL":"/index.json","highlightTag":"em","ignoreFieldNorm":false,"ignoreLocation":false,"isCaseSensitive":false,"location":0,"maxResultLength":10,"minMatchCharLength":2,"noResultsFound":"No results found","snippetLength":50,"threshold":0.3,"type":"fuse","useExtendedSearch":false},"sharerjs":true,"table":{"sort":true},"typeit":{"cursorChar":"|","cursorSpeed":1000,"data":{"desktop-header-typeit":["desktop-header-typeit"],"mobile-header-typeit":["mobile-header-typeit"]},"duration":-1,"speed":100}};</script><script type="text/javascript" src="/lib/tablesort/tablesort.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lightgallery.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lg-thumbnail.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lg-zoom.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/typeit/typeit.min.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js" defer></script><script type="text/javascript" src="/lib/katex/auto-render.min.js" defer></script><script type="text/javascript" src="/lib/katex/copy-tex.min.js" defer></script><script type="text/javascript" src="/lib/katex/mhchem.min.js" defer></script><script type="text/javascript" src="/js/katex.min.js" defer></script><script type="text/javascript" src="/lib/cookieconsent/cookieconsent.min.js" defer></script><script type="text/javascript" src="/js/cookieconsent.min.js" defer></script><script type="text/javascript" src="/js/theme.min.js" defer></script></div>
</body>

</html>
